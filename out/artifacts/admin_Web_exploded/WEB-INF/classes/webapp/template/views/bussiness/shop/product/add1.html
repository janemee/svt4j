<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <!--商品发布页面-->
    <!-- 样式文件加载开始 -->
    <#include "/include/res.html" >
    <script type="text/javascript" src="/ui/js/jquery-2.1.1.min.js"></script>
    <!--引入CSS-->
    <link rel="stylesheet" type="text/css" href="/ui/css/plugins/webuploader/webuploader.css">

    <!--引入JS-->
    <script type="text/javascript" src="/ui/js/plugins/webuploader/webuploader.min.js"></script>

    <!-- 样式文件加载结束 -->
    <style>
        #container {
            color: #838383;
            font-size: 12px;
        }

        div[id^="uploader-"] .queueList {
            margin: 20px;
            border: 3px dashed #e6e6e6;
        }

        div[id^="uploader-"] .queueList.filled {
            padding: 17px;
            margin: 0;
            border: 3px dashed transparent;
        }

        div[id^="uploader-"] .queueList.webuploader-dnd-over {
            border: 3px dashed #999999;
        }

        /*=================================================================*/
        div[id^="uploader-"] .queueList-small.filled {
            /*padding: 17px;*/
            margin: 0;
            /*border: 3px dashed transparent;*/
        }

        div[id^="uploader-"] .queueList-small.webuploader-dnd-over {
            border: 3px dashed #999999;
        }

        div[id^="uploader-"] .placeholder-small {
            /*min-height: 350px;*/
            /*padding-top: 178px;*/
            /*text-align: center;*/
            background: url("${imgRoot}webuploader/webuploader.png") center 93px no-repeat;
            color: #cccccc;
            font-size: 18px;
            position: relative;
        }

        div[id^="uploader-"] .placeholder-small .webuploader-pick {
            font-size: 18px;
            background: #00b7ee;
            border-radius: 3px;
            line-height: 44px;
            padding: 0 30px;
            *width: 120px;
            color: #fff;
            display: inline-block;
            /*margin: 0 auto 20px auto;*/
            cursor: pointer;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        }

        div[id^="uploader-"] .placeholder-small .webuploader-pick-hover {
            background: #00a2d4;
        }

        div[id^="uploader-"] .placeholder-small .flashTip {
            color: #666666;
            font-size: 12px;
            position: absolute;
            width: 100%;
            text-align: center;
            bottom: 20px;
        }

        div[id^="uploader-"] .placeholder-small .flashTip a {
            color: #0785d1;
            text-decoration: none;
        }

        div[id^="uploader-"] .placeholder-small .flashTip a:hover {
            text-decoration: underline;
        }

        div[id^="uploader-"] .statusBar-small {
            /*height: 63px;*/
            /*border-top: 1px solid #dadada;*/
            /*padding: 0 20px;*/
            /*line-height: 63px;*/
            /*vertical-align: middle;*/
            position: relative;
        }

        div[id^="uploader-"] .statusBar-small .progress {
            border: 1px solid #1483d8;
            width: 198px;
            background: #fff;
            height: 18px;
            position: relative;
            display: inline-block;
            text-align: center;
            line-height: 20px;
            color: #6dbfff;
            position: relative;
            margin: 0 10px 0 0;
        }

        div[id^="uploader-"] .statusBar-small .progress span.percentage {
            width: 0;
            height: 100%;
            left: 0;
            top: 0;
            background: #1483d8;
            position: absolute;
        }

        div[id^="uploader-"] .statusBar-samll .progress span.text {
            position: relative;
            z-index: 10;
        }

        div[id^="uploader-"] .statusBar-small .info {
            display: inline-block;
            font-size: 14px;
            color: #666666;
        }

        div[id^="uploader-"] .statusBar-small .btns {
            /*position: absolute;*/
            top: 10px;
            right: 20px;
            line-height: 40px;
        }

        div[id^="filePicker2-"] {
            display: inline-block;
            float: left;
        }

        div[id^="uploader-"] .statusBar-small .btns .webuploader-pick,
        div[id^="uploader-"] .statusBar-small .btns .uploadBtn,
        div[id^="uploader-"] .statusBar-small .btns .uploadBtn.state-uploading,
        div[id^="uploader-"] .statusBar-small .btns .uploadBtn.state-paused {
            background: #ffffff;
            border: 1px solid #cfcfcf;
            color: #565656;
            padding: 0 18px;
            display: inline-block;
            border-radius: 3px;
            /*margin-left: 10px;*/
            cursor: pointer;
            font-size: 14px;
            /*float: left;*/
        }

        div[id^="uploader-"] .statusBar-small .btns .webuploader-pick-hover,
        div[id^="uploader-"] .statusBar-small .btns .uploadBtn:hover,
        div[id^="uploader-"] .statusBar-small .btns .uploadBtn.state-uploading:hover,
        div[id^="uploader-"] .statusBar-small .btns .uploadBtn.state-paused:hover {
            background: #f0f0f0;
        }

        div[id^="uploader-"] .statusBar-small .btns .uploadBtn {
            background: #00b7ee;
            color: #fff;
            border-color: transparent;
        }

        div[id^="uploader-"] .statusBar-small .btns .uploadBtn:hover {
            background: #00a2d4;
        }

        div[id^="uploader-"] .statusBar-small .btns .uploadBtn.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        /*==================================================================================*/
        div[id^="uploader-"] p {
            margin: 0;
        }

        .element-invisible {
            position: absolute !important;
            clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
            clip: rect(1px, 1px, 1px, 1px);
        }

        div[id^="uploader-"] .placeholder {
            min-height: 350px;
            padding-top: 178px;
            text-align: center;
            background: url("${imgRoot}webuploader/webuploader.png") center 93px no-repeat;
            color: #cccccc;
            font-size: 18px;
            position: relative;
        }

        div[id^="uploader-"] .placeholder .webuploader-pick {
            font-size: 18px;
            background: #00b7ee;
            border-radius: 3px;
            line-height: 44px;
            padding: 0 30px;
            *width: 120px;
            color: #fff;
            display: inline-block;
            margin: 0 auto 20px auto;
            cursor: pointer;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        }

        div[id^="uploader-"] .placeholder .webuploader-pick-hover {
            background: #00a2d4;
        }

        div[id^="uploader-"] .placeholder .flashTip {
            color: #666666;
            font-size: 12px;
            position: absolute;
            width: 100%;
            text-align: center;
            bottom: 20px;
        }

        div[id^="uploader-"] .placeholder .flashTip a {
            color: #0785d1;
            text-decoration: none;
        }

        div[id^="uploader-"] .placeholder .flashTip a:hover {
            text-decoration: underline;
        }

        div[id^="uploader-"] .filelist {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        div[id^="uploader-"] .filelist:after {
            content: '';
            display: block;
            width: 0;
            height: 0;
            overflow: hidden;
            clear: both;
        }

        div[id^="uploader-"] .filelist li {
            width: 110px;
            height: 110px;
            background: url("${imgRoot}webuploader/bg.png") no-repeat;
            text-align: center;
            margin: 0 8px 20px 0;
            position: relative;
            display: inline;
            float: left;
            overflow: hidden;
            font-size: 12px;
        }

        div[id^="uploader-"] .filelist li p.log {
            position: relative;
            top: -45px;
        }

        div[id^="uploader-"] .filelist li p.title {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            top: 5px;
            text-indent: 5px;
            text-align: left;
        }

        div[id^="uploader-"] .filelist li p.progress {
            position: absolute;
            width: 100%;
            bottom: 0;
            left: 0;
            height: 8px;
            overflow: hidden;
            z-index: 50;
            margin: 0;
            border-radius: 0;
            background: none;
            -webkit-box-shadow: 0 0 0;
        }

        div[id^="uploader-"] .filelist li p.progress span {
            display: none;
            overflow: hidden;
            width: 0;
            height: 100%;
            background: #1483d8 url("${imgRoot}webuploader/progress.png") repeat-x;

            -webit-transition: width 200ms linear;
            -moz-transition: width 200ms linear;
            -o-transition: width 200ms linear;
            -ms-transition: width 200ms linear;
            transition: width 200ms linear;

            -webkit-animation: progressmove 2s linear infinite;
            -moz-animation: progressmove 2s linear infinite;
            -o-animation: progressmove 2s linear infinite;
            -ms-animation: progressmove 2s linear infinite;
            animation: progressmove 2s linear infinite;

            -webkit-transform: translateZ(0);
        }

        @-webkit-keyframes progressmove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 17px 0;
            }
        }

        @-moz-keyframes progressmove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 17px 0;
            }
        }

        @keyframes progressmove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 17px 0;
            }
        }

        div[id^="uploader-"] .filelist li p.imgWrap {
            position: relative;
            z-index: 2;
            line-height: 110px;
            vertical-align: middle;
            overflow: hidden;
            width: 110px;
            height: 110px;

            -webkit-transform-origin: 50% 50%;
            -moz-transform-origin: 50% 50%;
            -o-transform-origin: 50% 50%;
            -ms-transform-origin: 50% 50%;
            transform-origin: 50% 50%;

            -webit-transition: 200ms ease-out;
            -moz-transition: 200ms ease-out;
            -o-transition: 200ms ease-out;
            -ms-transition: 200ms ease-out;
            transition: 200ms ease-out;
        }

        div[id^="uploader-"] .filelist li img {
            width: 100%;
        }

        div[id^="uploader-"] .filelist li p.error {
            background: #f43838;
            color: #fff;
            position: absolute;
            bottom: 0;
            left: 0;
            height: 28px;
            line-height: 28px;
            width: 100%;
            z-index: 100;
        }

        div[id^="uploader-"] .filelist li .success {
            display: block;
            position: absolute;
            left: 0;
            bottom: 0;
            height: 40px;
            width: 100%;
            z-index: 200;
            background: url("${imgRoot}webuploader/success.png") no-repeat right bottom;
        }

        div[id^="uploader-"] .filelist div.file-panel {
            position: absolute;
            height: 0;
            filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#80000000', endColorstr='#80000000') \0;
            background: rgba(0, 0, 0, 0.5);
            width: 100%;
            top: 0;
            left: 0;
            overflow: hidden;
            z-index: 300;
        }

        div[id^="uploader-"] .filelist div.file-panel span {
            width: 24px;
            height: 24px;
            display: inline;
            float: right;
            text-indent: -9999px;
            overflow: hidden;
            background: url("${imgRoot}webuploader/icons.png") no-repeat;
            margin: 5px 1px 1px;
            cursor: pointer;
        }

        div[id^="uploader-"] .filelist div.file-panel span.rotateLeft {
            background-position: 0 -24px;
        }

        div[id^="uploader-"] .filelist div.file-panel span.rotateLeft:hover {
            background-position: 0 0;
        }

        div[id^="uploader-"] .filelist div.file-panel span.rotateRight {
            background-position: -24px -24px;
        }

        div[id^="uploader-"] .filelist div.file-panel span.rotateRight:hover {
            background-position: -24px 0;
        }

        div[id^="uploader-"] .filelist div.file-panel span.cancel {
            background-position: -48px -24px;
            margin-right: 10px;
        }

        div[id^="uploader-"] .filelist div.file-panel span.cancel:hover {
            background-position: -48px 0;
        }

        div[id^="uploader-"] .statusBar {
            height: 63px;
            border-top: 1px solid #dadada;
            padding: 0 20px;
            line-height: 63px;
            vertical-align: middle;
            position: relative;
        }

        div[id^="uploader-"] .statusBar .progress {
            border: 1px solid #1483d8;
            width: 198px;
            background: #fff;
            height: 18px;
            position: relative;
            display: inline-block;
            text-align: center;
            line-height: 20px;
            color: #6dbfff;
            position: relative;
            margin: 0 10px 0 0;
        }

        div[id^="uploader-"] .statusBar .progress span.percentage {
            width: 0;
            height: 100%;
            left: 0;
            top: 0;
            background: #1483d8;
            position: absolute;
        }

        div[id^="uploader-"] .statusBar .progress span.text {
            position: relative;
            z-index: 10;
        }

        div[id^="uploader-"] .statusBar .info {
            display: inline-block;
            font-size: 14px;
            color: #666666;
        }

        div[id^="uploader-"] .statusBar .btns {
            position: absolute;
            top: 10px;
            right: 20px;
            line-height: 40px;
        }

        div[id^="filePicker2-"] {
            display: inline-block;
            float: left;
        }

        div[id^="uploader-"] .statusBar .btns .webuploader-pick,
        div[id^="uploader-"] .statusBar .btns .uploadBtn,
        div[id^="uploader-"] .statusBar .btns .uploadBtn.state-uploading,
        div[id^="uploader-"] .statusBar .btns .uploadBtn.state-paused {
            background: #ffffff;
            border: 1px solid #cfcfcf;
            color: #565656;
            padding: 0 18px;
            display: inline-block;
            border-radius: 3px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 14px;
            float: left;
        }

        div[id^="uploader-"] .statusBar .btns .webuploader-pick-hover,
        div[id^="uploader-"] .statusBar .btns .uploadBtn:hover,
        div[id^="uploader-"] .statusBar .btns .uploadBtn.state-uploading:hover,
        div[id^="uploader-"] .statusBar .btns .uploadBtn.state-paused:hover {
            background: #f0f0f0;
        }

        div[id^="uploader-"] .statusBar .btns .uploadBtn {
            background: #00b7ee;
            color: #fff;
            border-color: transparent;
        }

        div[id^="uploader-"] .statusBar .btns .uploadBtn:hover {
            background: #00a2d4;
        }

        div[id^="uploader-"] .statusBar .btns .uploadBtn.disabled {
            pointer-events: none;
            opacity: 0.6;
        }
        #icon-pic-img-div div {
            position: relative;
            float: left;
        }
        #app-pic-img-div div {
            position: relative;
            float: left;
        }
        #icon-pic-img-div div span,
        #app-pic-img-div div span{
            position: absolute;
            width: 110px;
            height: 0px;
            background: rgba(0, 0, 0, 0.5);
            text-align: center;
            left: 0;
            color:#fff;
            line-height: 30px;
            overflow: hidden;
        }
        .chosen-container {
            width: 286px !important;
        }
        #dlbtb {
            border: 1px solid #e7eaec
        }
        #dlbtb th{
            text-align: center;
            vertical-align: middle;
            background-color: #F5F5F6;
            line-height: 1.42857;
            padding: 12px 20px;
            border: 1px solid #e7eaec;
        }
        #dlbtb td{
            text-align: center;
            vertical-align: middle;
            line-height: 1.42857;
            padding: 12px 20px;
            border: 1px solid #e7eaec;
        }
        #skuGroupTable_rn {
            width: 75px !important;
        }
        /*.jqgrid-rownum {*/
        /*    width: 50px !important;*/
        /*}*/
    </style>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content ">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox-content">
                <form class="form-horizontal m-t" id="form">
                    <!--商品基本信息 label-->
                    <div class="col-sm-12"
                         style="border: 1px solid rgba(204, 204, 204, 1);padding: 15px 20px 20px 20px;background-color: rgba(242, 242, 242, 1);">
                        <h3 style="margin-bottom: 1px;">商品基本信息</h3>
                    </div>
                    <!--商品名称-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">商品名称:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_name" name="title" class="form-control" type="text" required>
                        </div>
                    </div>
                    <!-- 标签 -->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">标签:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_tag_name" name="title" class="form-control" required>
                        </div>
                    </div>
                    <!--商品描述-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">商品描述:&nbsp;</label>
                        <div class="col-sm-4">
                            <input id="input_product_content" name="content" class="form-control" type="text">
                        </div>
                    </div>
                    <!--价格-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">价格:&nbsp;</label>
                        <div class="col-sm-4">
                            <input id="input_product_price" name="content" class="form-control" type="number" required>
                        </div>

                    </div>
                    <!--价格-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">成本价:&nbsp;</label>
                        <div class="col-sm-4">
                            <input id="input_product_cost_price" name="content" class="form-control" type="number" required>
                        </div>

                    </div>
                    <!--销售截止时间-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">销售截止时间:&nbsp;</label>
                        <div class="col-sm-4">
                            <input id="input_product_outage_time" name="content" class="form-control" type="text">
                        </div>
                    </div>

                    <!--商品基本信息 label-->
                    <div class="col-sm-12"
                         style="border: 1px solid rgba(204, 204, 204, 1);padding: 15px 20px 20px 20px;background-color: rgba(242, 242, 242, 1);">
                        <h3 style="margin-bottom: 1px;">商品详情信息</h3>
                    </div>
                    <!--产地-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">产地:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_origin_place" name="title" class="form-control" type="text" required>
                        </div>
                    </div>
                    <!--产出物-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">产出物:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_output_items" name="title" class="form-control" type="text" required>
                        </div>
                    </div>
                    <!--持有期-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">持有期:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_hold_term" name="title" class="form-control" required>年
                        </div>
                    </div>
                    <!--预计产量-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">预计产量:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_output_yield" name="title" class="form-control" required>
                        </div>
                    </div>
                    <!--下次收获时间-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">下次收获时间:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_next_receive_time" name="title" class="form-control" required>
                        </div>
                    </div>
                    <!--位置-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">位置:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_address" name="title" class="form-control" required>
                        </div>
                    </div>
                    <!--权益-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">权益:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_sku_rights_interests" name="title" class="form-control" required>
                        </div>
                    </div>

                    <!--======================================================================================-->
                    <!--商品缩略图 label-->
                    <div class="col-sm-12"
                         style="border: 1px solid rgba(204, 204, 204, 1);padding: 15px 20px 20px 20px;background-color: rgba(242, 242, 242, 1);">
                        <h3 style="margin-bottom: 1px;">商品图片</h3>
                    </div>
                    <!--商品首页图片上传 上传区-->
                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品轮播图:<i class="required-help">*</i></label>
                        <!--百度 web uploader-->
                        <div class="col-sm-10" id="icon-pic-img-div">
                            <div><img id="icon-pic-img0" style="width: 110px; height: 110px;" hidden /><span id="delete0">删除</span></div>
                            <div><img id="icon-pic-img1" style="width: 110px; height: 110px;" hidden /><span id="delete1">删除</span></div>
                            <div><img id="icon-pic-img2" style="width: 110px; height: 110px;" hidden /><span id="delete2">删除</span></div>
                            <div><img id="icon-pic-img3" style="width: 110px; height: 110px;" hidden /><span id="delete3">删除</span></div>
                            <div><img id="icon-pic-img4" style="width: 110px; height: 110px;" hidden /><span id="delete4">删除</span></div>
                        </div>
                        <div class="col-sm-10" id="icon-pic-uploader-div">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2">
                        </div>
                        <div class="col-sm-10" id="icon-pic-uploader-div2">
                        </div>
                    </div>
                    <!--================================================================================================-->
                    <!--&lt;!&ndash;移动端商品详情描述 长图片上传 label&ndash;&gt;-->
                    <!--<div class="col-sm-12"-->
                         <!--style="border: 1px solid rgba(204, 204, 204, 1);padding: 15px 20px 20px 20px;background-color: rgba(242, 242, 242, 1);">-->
                        <!--<h3 style="margin-bottom: 1px;">商品详情描述</h3>-->
                    <!--</div>-->
                    <!--移动端商品详情描述 长图片上传 上传区-->
                    <div class="form-group">
                        <label class="col-sm-2 control-label">移动端商品描述:<i class="required-help">*</i></label>
                        <!--百度 web uploader-->
                        <div class="col-sm-10" id="app-pic-img-div">
                            <div><img id="app-pic-img0" style="width: 110px; height: 110px;" hidden/><span id="delete-0">删除</span></div>
                            <div><img id="app-pic-img1" style="width: 110px; height: 110px;" hidden/><span id="delete-1">删除</span></div>
                            <div><img id="app-pic-img2" style="width: 110px; height: 110px;" hidden/><span id="delete-2">删除</span></div>
                            <div><img id="app-pic-img3" style="width: 110px; height: 110px;" hidden/><span id="delete-3">删除</span></div>
                            <div><img id="app-pic-img4" style="width: 110px; height: 110px;" hidden/><span id="delete-4">删除</span></div>
                        </div>
                        <div class="col-sm-10" id="app-pic-uploader-div">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-2">
                        </div>
                        <div class="col-sm-10" id="app-pic-uploader-div2">
                        </div>
                    </div>
                    <div class="col-sm-12"
                         style="border: 1px solid rgba(204, 204, 204, 1);padding: 15px 20px 20px 20px;background-color: rgba(242, 242, 242, 1);">
                        <h3 style="margin-bottom: 1px;">项目信息</h3>
                    </div>
                    <!--项目名称-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">项目名称:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_project_name" name="title" class="form-control" type="text" required>
                        </div>
                    </div>
                    <!--项目交付-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">项目交付:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_project_deliver" name="title" class="form-control" type="text" required>
                        </div>
                    </div>
                    <!--项目位置-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">项目位置:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <input id="input_product_project_place" name="title" class="form-control" type="text" required>
                        </div>
                    </div>
                    <!--项目状况-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">项目状况:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <textarea id="input_product_project_status" name="title" class="form-control" required ></textarea>
                        </div>
                    </div>
                    <!--项目特色-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">项目特色:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <textarea id="input_product_project_income" name="title" class="form-control" required ></textarea>
                        </div>
                    </div>
                    <!--交付回报-->
                    <div class="form-group col-sm-12">
                        <label class="col-sm-2 control-label">交付回报:<i class="required-help">*</i></label>
                        <div class="col-sm-4">
                            <textarea id="input_product_project_characteristic" name="title" class="form-control" required ></textarea>
                        </div>
                    </div>
                </form>
                <button type="button" class="btn btn-primary" id="saveBtn">确定</button>
            </div>
        </div>
    </div>
</div>


<!-- js加载开始 -->
<#include "/include/js.html">

<script type="text/javascript">
    var jqGridId = "#skuGroupTable",
        saveUrl = "${cxt!}/s/goodsType/json/save",
        getPropertyUrl = "${cxt!}/s/property/json/getPropValue",
        formId = "#form",
        winname = "${winname!}";
    var addSkuUrl = "${cxt!}/s/goods/addSku";
    var editSkuUrl = "${cxt!}/s/goods/editSku";
    var winWidth = '850px',
        winHeight = '500px';
    // sku index栈
    var skuStack = [3, 2, 1];
    // 保存sku
    var skuContainer = [];

    // 保存第一组sku勾选的值,用于普通图片数据的json解析
    var firstSkuValueArr = [];
    // 图片上传返回的url容器
    var urlContainer;
    // app图片上传返回的url容器
    var appUrlContainer = {"pic_arr": []};
    // homePicContainer
    var iconPicContainer = {"pic_arr": []};
    // 优化retina, 在retina下这个值是2
    var ratio = window.devicePixelRatio || 1;
    // 缩略图大小
    var thumbnailWidth = 110 * ratio;
    var thumbnailHeight = 110 * ratio;
    // sku勾选的组数
    var checkedSkuGroupCount = 0;

    var adminServerUrl = "${adminServerUrl}";
    var arr = {}
    arr["pic_arr"] = []
    var dlb = []//保存大礼包选中id
    var dlbArr = []//保存大礼包选中文本
    var dlbPrice = []
    var dlbGoods = []
    // ============================= 新增 start ========================
    // ============================= 新增 end ========================

    $('#select_types_type').on('change', function() {
        if ($(this).val() == '1') {
            $("#skuDiv").empty()
            $("#code1").show()
            $("#code2").hide()
            $('#table').show()
            $('#table1').hide()
            $('#price').hide()
            $("#storage").hide()
            $("#flower").hide()
            // $("tbody").empty()
        } else if ($(this).val() == '2') {
            $("#skuDiv").empty()
            $("#code2").show()
            $("#code1").hide()
            $('#table').hide()
            $('#table1').show()
            $('#price').show()
            $("#storage").show()
            $("#flower").show()
        }
    })
    $('#select_dlb_id').on('change', function() {
        dlbArr = []
        dlb = $('#select_dlb_id').val()
        var select = $('#select_dlb_id option:selected')
        for(i=0;i<select.length;i++){
            dlbArr.push(select[i].text);
        }
        dlbArr.shift()
        var str = ''
        for (var i = 0; i < dlbArr.length;i++) {
            str += '<tr><td>'+i+'</td><td>'+ dlbArr[i]+'</td><td><input class="everyPrice" type="text"></td></tr>'
        }
        $("#dlbtb tbody").empty()
        $("#dlbtb tbody").append($(str));
    })
    funcs = {
        initSubmit: function (form) {
            $(formId).validate({
                errorElement: 'span', //default input error message container
                errorClass: 'help-block', // default input error message class
                focusInvalid: false, // do not focus the last invalid input
                ignore: "",
                rules: {},
                invalidHandler: function (event, validator) { //display error alert on form submit
                },
                highlight: function (element) { // hightlight error inputs
                    $(element).closest('.form-group').addClass('has-error'); // set error class to the control group
                },
                unhighlight: function (element) { // revert the change done by hightlight
                    $(element).closest('.form-group').removeClass('has-error'); // set error class to the control group
                },
                success: function (label) {
                    label.closest('.form-group').removeClass('has-error'); // set success class to the control group
                    label.remove();
                },
                submitHandler: function (form) {
                    var title = "系统提示";
                    var index = parent.layer.getFrameIndex(window.name);
                    //loading层提示
                    var loading = layer.load(2, {
                        shade: [0.3, '#fff']
                    });
                    $.ajax({
                        type: "POST",
                        async: false,
                        data: $(form).serialize(),
                        url: saveUrl,
                        success: function (data) {
                            var successMsg = "操作成功!",
                                failedMsg = "操作失败!";
                            if (data.code == 200) {
                                parent.notifications('success', successMsg, title);
                            } else {
                                parent.notifications('error', failedMsg, title);
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            parent.notifications('error', "操作失败,请检查网络!", title);
                        },
                        complete: function () {
                            layer.close(loading);
                            parent.layer.close(index);
                        }
                    });
                }
            });
        }

    };

    jQuery(document).ready(function () {
        funcs.initSubmit();
        // icon
        uploaderManager.buildSmallUploader("icon-pic-uploader-div", "icon-pic-uploader-div2", "icon-pic-uploader-div", "icon-pic-img", "icon-pic-img-div", iconPicContainer, "icon-pic");
        // app
        uploaderManager.buildSmallUploader("app-pic-uploader-div", "app-pic-uploader-div2", "app-pic-uploader-div", "app-pic-img", "app-pic-img-div", appUrlContainer, "app-pic");
        // 初始化property容器
        propertyManager.init();
    });

    var uploaderManager = {
        // skuValue 主图规格值 对应数组名称
        // index 图片上传区的唯一标志
        // fileCountLimit 图片上传区图片数量限制
        // singleSizeLimit 单张图片大小限制 MB
        buildBigUploader: function (skuValue, index, fileCountLimit, singleSizeLimit) {
            if (!fileCountLimit) {
                fileCountLimit = 2;
            }
            if (!singleSizeLimit) {
                singleSizeLimit = 2;
            }
            _this = this;
            var $wrap = $('#uploader-' + index),

                $queue = $('<ul class="filelist"></ul>')
                    .appendTo($wrap.find('.queueList')),

                // 状态栏，包括进度和控制按钮
                $statusBar = $wrap.find('.statusBar'),

                // 文件总体选择信息。
                $info = $statusBar.find('.info'),

                // 上传按钮
                // $upload = $wrap.find('.uploadBtn'),
                $upload = $('#uploadBtn-' + index),

                // 没选择文件之前的内容。
                $placeHolder = $wrap.find('.placeholder'),

                // 总体进度条
                $progress = $statusBar.find('.progress').hide(),

                // 添加的文件数量
                fileCount = 0,

                // 添加的文件总大小
                fileSize = 0,

                // 优化retina, 在retina下这个值是2
                ratio = window.devicePixelRatio || 1,

                // 缩略图大小
                thumbnailWidth = 110 * ratio,
                thumbnailHeight = 110 * ratio,

                // 可能有pedding, ready, uploading, confirm, done.
                state = {"state": "pedding"},

                // 所有文件的进度信息，key为file id
                percentages = {},

                supportTransition = (function () {
                    var s = document.createElement('p').style,
                        r = 'transition' in s ||
                            'WebkitTransition' in s ||
                            'MozTransition' in s ||
                            'msTransition' in s ||
                            'OTransition' in s;
                    s = null;
                    return r;
                })();
            // 实例化这个上传区
            var uploader = WebUploader.create({
                pick: {
                    id: '#filePicker-' + index,
                    label: '点击选择图片'
                },
                dnd: '#uploader-' + index + ' .queueList',
                paste: document.body,

                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                },

                // swf文件路径
                swf: '/ui/js/lib/webuploader/Uploader.swf',

                disableGlobalDnd: true,

                chunked: true,
                // server: 'http://webuploader.duapp.com/server/fileupload.php',
                server: adminServerUrl + '/s/file/multi_upload',
                fileNumLimit: fileCountLimit,
                fileSizeLimit: fileCountLimit * singleSizeLimit * 1024 * 1024,    // 总共5M
                fileSingleSizeLimit: singleSizeLimit * 1024 * 1024    // 单个1M
            });

            // 在#filePicker2的div里增加一个按钮, 当首次添加完图片后,将显示该按钮
            // 添加“添加文件”的按钮，
            // uploader.addButton({
            //     id: '#filePicker2-' + index,
            //     label: '继续添加'
            // });

            // 设置进度条事件
            uploader.onUploadProgress = function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress span');

                $percent.css('width', percentage * 100 + '%');
                percentages[file.id][1] = percentage;
                _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
            };

            // 设置文件加队列事件
            uploader.onFileQueued = function (file) {
                fileCount++;
                if (fileCount > fileCountLimit) {
                    alert("图片数量超出限制");
                    uploader.removeFile(file);
                    return;
                }
                fileSize += file.size;
                if (fileSize > fileCountLimit * singleSizeLimit * 1024 * 1024) {
                    alert("图片大小超出限制");
                    uploader.removeFile(file);
                    return;
                }

                if (fileCount === 1) {
                    $placeHolder.addClass('element-invisible');
                    $statusBar.show();
                }

                _this.addFile(uploader, $queue, file, percentages, supportTransition);
                state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'ready', fileCount, fileSize);
                _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
            };

            // 设置文件减队列事件
            uploader.onFileDequeued = function (file) {
                fileCount--;
                fileSize -= file.size;
                urlContainer[skuValue] = urlContainer[skuValue].filter(function (ele, index) {
                    return ele["fileId"] != file.id;
                });
                if (!fileCount) {
                    state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'pedding', fileCount, fileSize);
                }
                _this.removeFile(uploader, $info, state, file, $progress, percentages, fileCount, fileSize);
                _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
            };

            uploader.on('all', function (type) {
                var stats;
                switch (type) {
                    case 'uploadFinished':
                        $upload.text('开始上传');
                        // if (fileCountLimit <= fileCount) {
                        //     $upload.addClass('disabled');
                        // }
                        state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'confirm', fileCount, fileSize);
                        break;

                    case 'startUpload':
                        state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'uploading', fileCount, fileSize);
                        break;

                    case 'stopUpload':
                        state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'paused', fileCount, fileSize);
                        break;

                }
            });

            // 设置错误处理事件
            uploader.onError = function (code) {
                var text;
                switch (code) {
                    case "F_EXCEED_SIZE":
                        text = "图片大小超出限制";
                        break;
                    case "Q_EXCEED_SIZE_LIMIT":
                        text = "总大小超出限制";
                        break;
                    case "Q_EXCEED_NUM_LIMIT":
                        text = "图片数量超出限制";
                        break;
                    default:
                        text = code;
                        break;
                }
                alert('Eroor: ' + text);
            };

            // 上传成功回调
            uploader.onUploadSuccess = function (file, response) {
                // path.push(response);
                // $('#' + file.id).addClass('upload-state-success').find(".state").text("已上传");    //这段代码根据需要选择是否写，也就是这句话可有可无
                // 数据格式修改 urlcontainer={"name":skuName,value1:[],value2:[]}
                urlContainer[skuValue] = urlContainer[skuValue].concat({
                    "fileId": file.id,
                    "url": response["data"]["urlArray"][0]
                });
            };

            uploader.refresh();

            // 设置上传按钮点击事件
            $upload.on('click', function () {
                if ($(this).hasClass('disabled')) {
                    return false;
                }

                if (state["state"] === 'ready') {
                    uploader.upload();
                } else if (state["state"] === 'paused') {
                    uploader.upload();
                } else if (state["state"] === 'uploading') {
                    uploader.stop();
                }
            });

            // 重试点击事件
            $info.on('click', '.retry', function () {
                uploader.retry();
            });

            // 忽略点击事件
            $info.on('click', '.ignore', function () {
                alert('todo');
            });

            // 开始上传按钮增加class
            $upload.addClass('state-' + state["state"]);
            _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
        },
        // div_id 初始的uploader渲染区,div_id2 上传过之后的图片渲染区,t_div_id 渲染uploader的区初始是1之后是2,img_id 上传后图片预览区,img_div_id 上传后预览区所在div,container 全局url容器,index 每个图片上传区的唯一标志
        buildSmallUploader: function (div_id, div_id2, t_div_id, img_id, img_div_id, container, index) {
            var _this = this;
            // var html = '<div class="ibox-content" style="border: 1px solid #e7eaec; margin-top: 10px;">' +
            var html = '<div id="uploader-ibox-content-' + index + '">' +
                '<div class="page-container">' +
                '<div id="uploader-' + index + '" class="wu-example">' +
                '<div class="queueList-small" style="margin: 0px;border:none;">' +
                '<div id="dndArea' + index + '" class="placeholder-small">' +
                '<div id="filePicker-' + index + '"></div>' +
                // '<p>或将照片拖到这里，单次最多可选5张</p>' +
                '</div>' +
                '</div>' +
                '<div class="statusBar-small" style="display:none;">' +
                '<div class="progress">' +
                '<span class="text">0%</span>' +
                '<span class="percentage"></span>' +
                '</div>' +
                '<div class="info"></div>' +
                '<div class="btns">' +
                // '<div id="filePicker2-' + index + '"></div>' +
                '<div class="uploadBtn" id="uploadBtn-' + index + '">开始上传</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';

            $("#" + t_div_id).append($(html));

            var $wrap = $('#uploader-' + index),

                $queue = $('<ul class="filelist"></ul>')
                    .appendTo($wrap.find('.queueList-small')),

                // 状态栏，包括进度和控制按钮
                $statusBar = $wrap.find('.statusBar-small'),

                // 文件总体选择信息。
                $info = $statusBar.find('.info'),

                // 上传按钮
                // $upload = $wrap.find('.uploadBtn'),
                $upload = $('#uploadBtn-' + index),

                // 没选择文件之前的内容。
                $placeHolder = $wrap.find('.placeholder-small'),

                // 总体进度条
                $progress = $statusBar.find('.progress').hide(),

                // 添加的文件数量
                fileCount = 0,

                // 添加的文件总大小
                fileSize = 0,

                // 优化retina, 在retina下这个值是2
                ratio = window.devicePixelRatio || 1,

                // 缩略图大小
                thumbnailWidth = 110 * ratio,
                thumbnailHeight = 110 * ratio,

                // 可能有pedding, ready, uploading, confirm, done.
                state = {"state": "pedding"},

                // 所有文件的进度信息，key为file id
                percentages = {},

                supportTransition = (function () {
                    var s = document.createElement('p').style,
                        r = 'transition' in s ||
                            'WebkitTransition' in s ||
                            'MozTransition' in s ||
                            'msTransition' in s ||
                            'OTransition' in s;
                    s = null;
                    return r;
                })();
            // 实例化这个上传区
            var uploader = WebUploader.create({
                pick: {
                    id: '#filePicker-' + index,
                    label: '点击选择图片'
                },
                dnd: '#uploader-' + index + ' .queueList-small',
                paste: document.body,

                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                },

                // swf文件路径
                swf: '/ui/js/lib/webuploader/Uploader.swf',

                disableGlobalDnd: true,

                chunked: true,
                // server: 'http://webuploader.duapp.com/server/fileupload.php',
                server: adminServerUrl + '/s/file/multi_upload',
                fileNumLimit: 5,
                fileSizeLimit: 10 * 1024 * 1024 * 5,    // 总共2M
                fileSingleSizeLimit: 10 * 1024 * 1024 * 5    // 单个2M
            });

            // 在#filePicker2的div里增加一个按钮, 当首次添加完图片后,将显示该按钮
            // 添加“添加文件”的按钮，
            // uploader.addButton({
            //     id: '#filePicker2-' + index,
            //     label: '继续添加'
            // });

            // 设置进度条事件
            uploader.onUploadProgress = function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress span');

                $percent.css('width', percentage * 100 + '%');
                percentages[file.id][1] = percentage;
                _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
            };

            // 设置文件加队列事件
            uploader.onFileQueued = function (file) {
                fileCount++;
                fileSize += file.size;

                if (fileCount === 1) {
                    $placeHolder.addClass('element-invisible');
                    $statusBar.show();
                }

                _this.addFile(uploader, $queue, file, percentages, supportTransition);
                state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'ready', fileCount, fileSize);
                _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
            };

            // 设置文件减队列事件
            uploader.onFileDequeued = function (file) {
                fileCount--;
                fileSize -= file.size;

                if (!fileCount) {
                    state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'pedding', fileCount, fileSize);
                }
                _this.removeFile(uploader, $info, state, file, $progress, percentages, fileCount, fileSize);
                _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);

            };

            uploader.on('all', function (type) {
                var stats;
                switch (type) {
                    case 'uploadFinished':
                        $upload.text('开始上传').addClass('disabled');
                        state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'confirm', fileCount, fileSize);
                        break;

                    case 'startUpload':
                        state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'uploading', fileCount, fileSize);
                        break;

                    case 'stopUpload':
                        state = _this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'paused', fileCount, fileSize);
                        break;
                }
            });

            // 设置错误处理事件
            uploader.onError = function (code) {
                var text;
                switch (code) {
                    case "F_EXCEED_SIZE":
                        text = "图片大小超出限制";
                        break;
                    case "Q_EXCEED_SIZE_LIMIT":
                        text = "总大小超出限制";
                        break;
                    case "Q_EXCEED_NUM_LIMIT":
                        text = "图片数量超出限制";
                        break;
                    default:
                        text = code;
                        break;
                }
                alert('Eroor: ' + text);
            };

            // 上传成功回调
            uploader.onUploadSuccess = function (file, response) {
                // path.push(response);
                // $('#' + file.id).addClass('upload-state-success').find(".state").text("已上传");    //这段代码根据需要选择是否写，也就是这句话可有可无
                // 清空容器并设置内容
                // urlContainer = {
                //     "icon": response["data"]["urlArray"]
                // }
                if (index == 'icon-pic') {
                    if (container["pic_arr"].length >= 5) {
                        container["pic_arr"].shift()
                    }
                    container["pic_arr"].push(...response["data"]["urlArray"])
                } else {
                    if (arr["pic_arr"].length >= 5) {
                        arr["pic_arr"].shift()
                    }
                    arr["pic_arr"].push(...response["data"]["urlArray"])
                }
                // console.log(arr)
                // console.log(container["pic_arr"])

                // container["pic_arr"] = response["data"]["urlArray"];
                for (var i = 0;i < container["pic_arr"].length;i++) {
                    $("#" + img_id + i).attr("src", container["pic_arr"][i]);
                    $("#" + img_id + i).show();
                    $("#" + img_id + i).parent().show();
                }
                for (var l = 0;l < arr["pic_arr"].length;l++) {
                    $("#app-pic-img" + l).attr("src", arr["pic_arr"][l]);
                    $("#app-pic-img" + l).show();
                    $("#app-pic-img" + l).parent().show();
                }
                var cons = $("#icon-pic-img-div").children()
                for (let i = 0; i < cons.length;i++) {
                    cons[i].onmouseenter = function() {
                        $("#delete" + i).stop().animate({height: 30})
                    }
                    cons[i].onmouseleave = function() {
                        $("#delete" + i).stop().animate({height: 0})
                    }
                    $("#delete" + i).off('click').on("click", function() {
                        container["pic_arr"].splice(i,1)
                        $("#icon-pic-img" + i).hide();
                        $("#icon-pic-img" + i).parent().hide();
                    })
                }
                var cons1 = $("#app-pic-img-div").children()
                for (let i = 0; i < cons1.length;i++) {
                    cons1[i].onmouseenter = function() {
                        $("#delete-" + i).stop().animate({height: 30})
                    }
                    cons1[i].onmouseleave = function() {
                        $("#delete-" + i).stop().animate({height: 0})
                    }
                    $("#delete-" + i).off('click').on("click", function() {
                        arr["pic_arr"].splice(i,1)
                        $("#app-pic-img" + i).hide();
                        $("#app-pic-img" + i).parent().hide();
                    })
                }
                // $("#" + img_id).attr("src", (response["data"]["urlArray"][0]));
                // $("#" + img_div_id).show();
                _this.cleanAndInitUploaderSmall(div_id, div_id2, div_id2, img_id, img_div_id, container, index);
            }
            uploader.refresh();

            // 设置上传按钮点击事件
            $upload.on('click', function () {
                if ($(this).hasClass('disabled')) {
                    return false;
                }

                if (state["state"] === 'ready') {
                    uploader.upload();
                } else if (state["state"] === 'paused') {
                    uploader.upload();
                } else if (state["state"] === 'uploading') {
                    uploader.stop();
                }
            });

            // 重试点击事件
            $info.on('click', '.retry', function () {
                uploader.retry();
            });

            // 忽略点击事件
            $info.on('click', '.ignore', function () {
                alert('todo');
            });

            // 开始上传按钮增加class
            $upload.addClass('state-' + state["state"]);
            _this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
        },
        cleanAndInitUploaderSmall: function (div_id, div_id2, t_div_id, img_id, img_div_id, container, index) {
            $("#" + div_id).empty();
            $("#" + div_id2).empty();
            this.buildSmallUploader(div_id, div_id2, t_div_id, img_id, img_div_id, container, index);
        },
        addFile: function (uploader, $queue, file, percentages, supportTransition) {
            var $li = $('<li id="' + file.id + '">' +
                '<p class="title">' + file.name + '</p>' +
                '<p class="imgWrap"></p>' +
                '<p class="progress"><span></span></p>' +
                '</li>'),

                $btns = $('<div class="file-panel">' +
                    '<span class="cancel">删除</span>' +
                    '<span class="rotateRight">向右旋转</span>' +
                    '<span class="rotateLeft">向左旋转</span></div>').appendTo($li),
                $prgress = $li.find('p.progress span'),
                $wrap = $li.find('p.imgWrap'),
                $info = $('<p class="error"></p>'),

                showError = function (code) {
                    var text;
                    switch (code) {
                        case 'exceed_size':
                            text = '文件大小超出';
                            break;

                        case 'interrupt':
                            text = '上传暂停';
                            break;

                        default:
                            text = '上传失败，请重试';
                            break;
                    }

                    $info.text(text).appendTo($li);
                };

            if (file.getStatus() === 'invalid') {
                showError(file.statusText);
            } else {
                // @todo lazyload
                $wrap.text('预览中');
                uploader.makeThumb(file, function (error, src) {
                    if (error) {
                        $wrap.text('不能预览');
                        return;
                    }

                    var img = $('<img src="' + src + '">');
                    $wrap.empty().append(img);
                }, thumbnailWidth, thumbnailHeight);

                percentages[file.id] = [file.size, 0];
                file.rotation = 0;
            }

            file.on('statuschange', function (cur, prev) {
                if (prev === 'progress') {
                    $prgress.hide().width(0);
                } else if (prev === 'queued') {
                    // $li.off('mouseenter mouseleave');
                    $btns.find(".rotateRight").remove();
                    $btns.find(".rotateLeft").remove();
                    $btns.find(".cancel").css("position", "relative").css("float", "left").css("left", "45%");
                }

                // 成功
                if (cur === 'error' || cur === 'invalid') {
                    showError(file.statusText);
                    percentages[file.id][1] = 1;
                } else if (cur === 'interrupt') {
                    showError('interrupt');
                } else if (cur === 'queued') {
                    percentages[file.id][1] = 0;
                } else if (cur === 'progress') {
                    $info.remove();
                    $prgress.css('display', 'block');
                } else if (cur === 'complete') {
                    $li.append('<span class="success"></span>');
                }

                $li.removeClass('state-' + prev).addClass('state-' + cur);
            });

            $li.on('mouseenter', function () {
                $btns.stop().animate({height: 30});
            });

            $li.on('mouseleave', function () {
                $btns.stop().animate({height: 0});
            });

            $btns.on('click', 'span', function () {
                var index = $(this).index(),
                    deg;
                switch (index) {
                    case 0:
                        uploader.removeFile(file);
                        return;

                    case 1:
                        file.rotation += 90;
                        break;

                    case 2:
                        file.rotation -= 90;
                        break;
                }

                if (supportTransition) {
                    deg = 'rotate(' + file.rotation + 'deg)';
                    $wrap.css({
                        '-webkit-transform': deg,
                        '-mos-transform': deg,
                        '-o-transform': deg,
                        'transform': deg
                    });
                } else {
                    $wrap.css('filter', 'progid:DXImageTransform.Microsoft.BasicImage(rotation=' + (~~((file.rotation / 90) % 4 + 4) % 4) + ')');
                    // use jquery animate to rotation
                    // $({
                    //     rotation: rotation
                    // }).animate({
                    //     rotation: file.rotation
                    // }, {
                    //     easing: 'linear',
                    //     step: function( now ) {
                    //         now = now * Math.PI / 180;

                    //         var cos = Math.cos( now ),
                    //             sin = Math.sin( now );

                    //         $wrap.css( 'filter', "progid:DXImageTransform.Microsoft.Matrix(M11=" + cos + ",M12=" + (-sin) + ",M21=" + sin + ",M22=" + cos + ",SizingMethod='auto expand')");
                    //     }
                    // });
                }


            });

            $li.appendTo($queue);
            // $("#uploader-ibox-content-"+index).addClass("ibox-content uploader-ibox-content-border");
        },
        // 负责view的销毁
        removeFile: function (uploader, $info, state, file, $progress, percentages, fileCount, fileSize) {
            var $li = $('#' + file.id);
            // console.log(urlContainer)
            delete percentages[file.id];
            this.updateTotalProgress(uploader, $info, state, $progress, percentages, fileCount, fileSize);
            $li.off().find('.file-panel').off().end().remove();
            // $("#uploader-ibox-content-"+index).removeClass("ibox-content uploader-ibox-content-border");
        },
        updateTotalProgress: function (uploader, $info, state, $progress, percentages, fileCount, fileSize) {
            var loaded = 0,
                total = 0,
                spans = $progress.children(),
                percent;

            $.each(percentages, function (k, v) {
                total += v[0];
                loaded += v[0] * v[1];
            });

            percent = total ? loaded / total : 0;

            spans.eq(0).text(Math.round(percent * 100) + '%');
            spans.eq(1).css('width', Math.round(percent * 100) + '%');
            this.updateStatus(uploader, $info, state, fileCount, fileSize);
        },
        updateStatus: function (uploader, $info, state, fileCount, fileSize, successCount) {
            var text = '', stats;

            if (state["state"] === 'ready') {
                text = '选中' + fileCount + '张图片，共' +
                    WebUploader.formatSize(fileSize) + '。';
            } else if (state["state"] === 'confirm') {
                stats = uploader.getStats();
                if (stats.uploadFailNum) {
                    text = '已成功上传' + stats.successNum + '张照片至XX相册，' +
                        stats.uploadFailNum + '张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>'
                }

            } else {
                stats = uploader.getStats();
                // var actualSuccessCount = stats.successNum;
                // if (!successCount){
                //     actualSuccessCount = successCount;
                // }
                text = '共' + fileCount + '张（' +
                    WebUploader.formatSize(fileSize) +
                    '），已上传' + fileCount + '张';

                if (stats.uploadFailNum) {
                    text += '，失败' + stats.uploadFailNum + '张';
                }
            }

            $info.html(text);
        },
        setState: function (uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, val, fileCount, fileSize) {
            var file, stats;

            if (val === state) {
                return;
            }

            $upload.removeClass('state-' + state["state"]);
            $upload.addClass('state-' + val);
            state["state"] = val;

            switch (state["state"]) {
                case 'pedding':
                    $placeHolder.removeClass('element-invisible');
                    $queue.parent().removeClass('filled');
                    $queue.hide();
                    $statusBar.addClass('element-invisible');
                    uploader.refresh();
                    break;

                case 'ready':
                    $placeHolder.addClass('element-invisible');
                    // $('#filePicker2-' + index).removeClass('element-invisible');
                    $queue.parent().addClass('filled');
                    $queue.show();
                    $statusBar.removeClass('element-invisible');
                    uploader.refresh();
                    break;

                case 'uploading':
                    // $('#filePicker2-' + index).addClass('element-invisible');
                    $progress.show();
                    $upload.text('暂停上传');
                    break;

                case 'paused':
                    $progress.show();
                    $upload.text('继续上传');
                    break;

                case 'confirm':
                    $progress.hide();
                    // $upload.text('开始上传').addClass('disabled');

                    stats = uploader.getStats();
                    if (stats.successNum && !stats.uploadFailNum) {
                        state = this.setState(uploader, $upload, $placeHolder, $queue, $statusBar, $progress, $info, index, state, 'finish', fileCount, fileSize);
                        return state;
                    }
                    break;
                case 'finish':
                    stats = uploader.getStats();
                    if (stats.successNum) {
                        alert('上传成功');
                    } else {
                        // 没有成功的图片，重设
                        state["state"] = 'done';
                        location.reload();
                    }
                    break;
            }

            this.updateStatus(uploader, $info, state, fileCount, fileSize);
            return state;
        },
    }

    var skuContainer;
    var skuManager = {
        // 增加一组规格并渲染 {name:"", values:[]}
        addGroupAndRender: function () {
            if (!$("#select_types_type").val() ||　$("#select_types_type").val() == 0) {
                return alert('请选择商品种类')
            }

            var _this = this;
            if (skuStack.length < 1) {
                return;
            }
            var title = "添加商品规格";
            var url = addSkuUrl;
            //判断url中是否已经挂参
            if (url.indexOf("?") == -1) {
                url = url + "?winname=" + winname;
            } else {
                url = url + "&winname=" + winname;
            }
            url = url + "&goodsDic=" + $("#select_types_type").val();
            var index = parent.layer.open({
                // skin: 'layui-layer-molv',
                type: 2, //iframe 层
                title: title,
                scrollbar: false,
                fix: false, //不固定
                maxmin: true,
                area: [winWidth, winHeight],
                btn: ['确定'],
                yes: function (index, layero) {
                    var data = window.parent[layero.find('iframe')[0]['name']].validateForm();
                    // data['name'] 规格名称
                    // data['values'] array 规格值
                    if (!data["name"]) {
                        alert("规格名称不能为空");
                        return;
                    }
                    for (var i = 0; i < data["values"].length; i++) {
                        // let reg = /^[\u4e00-\u9fa5_a-zA-Z0-9]+$/
                        // if (!reg.test(data["values"][i])) {
                        //     return alert("规格值只能为数字、字母和汉字")
                        // }
                        if (!data["values"][i]) {
                            alert("规格值不能为空");
                            return;
                        }
                    }
                    var addSuccess = propertyManager.add(data);
                    if (addSuccess) {
                        _this.render(data, propertyContainer["nameArr"].indexOf(data["name"]));
                        parent.layer.close(index);
                    }
                    if ($("#sub-sku-0")[0] && $("#select_types_type").val() == 2) {
                        $("#addSku").hide()
                    }
                },
                content: url

            });
        },
        // 更新一组规格并渲染
        updateGroupAndRender: function (data, index) {
            var _this = this;
            var title = "修改商品规格";
            var url = editSkuUrl;
            //判断url中是否已经挂参
            if (url.indexOf("?") == -1) {
                url = url + "?winname=" + winname + "&data=" + encodeURIComponent(JSON.stringify(data)) + "&index=" + index;
            } else {
                url = url + "&winname=" + winname + "&data=" + encodeURIComponent(JSON.stringify(data)) + "&index=" + index;
            }
            url = url + "&goodsDic=" + $("#select_types_type").val()
            var index = parent.layer.open({
                // skin: 'layui-layer-molv',
                type: 2, //iframe 层
                title: title,
                scrollbar: false,
                fix: false, //不固定
                maxmin: true,
                area: [winWidth, winHeight],
                btn: ['确定'],
                yes: function (sub_index, layero) {
                    // 弹窗页面validateForm()方法返回的json数据
                    var data = window.parent[layero.find('iframe')[0]['name']].validateForm();
                    // 调用弹窗的页面设置数据
                    if (!data["name"]) {
                        alert("规格名称不能为空");
                        return;
                    }
                    for (var i = 0; i < data["values"].length; i++) {
                        // let reg = /^[\u4e00-\u9fa5_a-zA-Z0-9]+$/
                        // if (!reg.test(data["values"][i])) {
                        //     return alert("规格值只能为数字、字母和汉字")
                        // }
                        if (!data["values"][i]) {
                            alert("规格值不能为空");
                            return;
                        }
                    }
                    var updateSuccess = propertyManager.updateFromEditor(data, data["index"]);
                    if (!updateSuccess) {
                        return;
                    }
                    var skuData = {};
                    skuData["name"] = data["name"];
                    skuData["values"] = data["values"];
                    // data['name'] 规格名称
                    // data['values'] array 规格值
                    // console.log(skuData)
                    _this.renderByIndex(skuData, data["index"]);
                    parent.layer.close(sub_index);
                },
                content: url
            });
        },
        // 追加渲染一组规格index是这组数据的数组下标
        render: function (data, index) {
            // 一个按钮,每行最多5个按钮
            var renderArea = $("#skuDiv");
            // 追加一个空白区 填充标题行下的空白,使规格数据对齐
            renderArea.append(
                $("<div class='col-sm-2' id='blank-sub-sku-" + index + "'></div>")
            );
            // 追加一个div用于渲染数据
            renderArea.append(
                $("<div class='col-sm-10' id='sub-sku-" + index + "' style='padding-bottom: 10px;'></div>")
            );
            var subRenderArea = $("#sub-sku-" + index);
            // 创建第一行带按钮的数据
            subRenderArea.append(
                this.buildFirstLine(data, index)
            );
            var length = data["values"].length;
            var d_length = length - 5;
            // 其他行
            if (d_length > 0) {
                var lineCount = Math.ceil(d_length / 5);
                for (var i = 0; i < lineCount; i++) {
                    subRenderArea.append(
                        this.buildOtherLine(data, index, i * 5 + 5)
                    );
                }
            }
            // 最后填充一条分割线
            subRenderArea.append(
                $("<div class='col-sm-12' style='margin-top: 10px; border-bottom: 1px solid rgba(204, 204, 204, 1);'></div>")
            )
        },
        // 构造第一行带按钮的行
        buildFirstLine: function (data, index) {
            // console.log(data)
            var str = $("<div class='col-sm-12' style='padding-left: 0px;'></div>").append(
                // 按钮
                // 按钮点击进入编辑页携带data数据
                $("<div class='col-sm-2' style='padding-left: 0px;'>" +
                    "<button type='button' onclick='editSku(" + JSON.stringify(data) + "," + index + ")' class='btn btn-primary'>" + data['name'] + "</button>" +
                    "<input type='hidden' id='input-sku-name-" + index + "' value='" + data['name'] + "'>" +
                    "</div>")
            );
            for (var i = 0; i < 5 && i < data["values"].length; i++) {
                var v1 = data['values'][i];
                str.append(
                    $("<div class='col-sm-2'>" +
                        "<div class='col-sm-2 checkbox' style='padding:8px 0 0 0;'>" +
                        "<input type='checkbox' id='radio-" + index + "-" + i + "' data-id-index='" + i + "'  onclick='radioOnchange(" + index + "," + i + ")' name='sku-" + index + "' value='" + v1 + "' >" +
                        "<label for='radio-" + index + "-" + i + "'></label>" +
                        "</div>" +
                        "<div class='col-sm-10' style='padding: 0 0 0 0;'>" +
                        "<label id='label-" + index + "-" + i + "' style='margin-top: 7px;overflow: auto;'>" + v1 + "</label>" +
                        "<input id='input-" + index + "-" + i + "' onchange='inputChange(" + index + "," + i + ")' value='" + v1 + "' style='display: none;' class='form-control'>" +
                        "</div>" +
                        "</div>")
                );
            }
            return str;
        },
        // 构造其他行,不带按钮
        buildOtherLine: function (data, index, start) {
            // 一个新行的div
            var str = $("<div class='col-sm-12' style='padding-left: 0px;'></div>").append(
                // 按钮填充位
                $("<div class='col-sm-12' style='padding-left: 0;'></div>").append(
                    $("<div class='col-sm-2'></div>")
                )
            );
            for (var i = start; i < start + 5 && i < data["values"].length; i++) {
                var v1 = data['values'][i];
                str.append(
                    $("<div class='col-sm-2'>" +
                        "<div class='col-sm-2 checkbox' style='padding:8px 0 0 0;'>" +
                        "<input type='checkbox' id='radio-" + index + "-" + i + "' data-id-index='" + i + "'  onclick='radioOnchange(" + index + "," + i + ")' name='sku-" + index + "' value='" + v1 + "' >" +
                        "<label for='radio-" + index + "-" + i + "'></label>" +
                        "</div>" +
                        "<div class='col-sm-10' style='padding: 0 0 0 0;'>" +
                        "<label id='label-" + index + "-" + i + "' style='margin-top: 7px;overflow: auto;'>" + v1 + "</label>" +
                        "<input id='input-" + index + "-" + i + "' onchange='inputChange(" + index + "," + i + ")' value='" + v1 + "' style='display: none;' class='form-control'>" +
                        "</div>" +
                        "</div>")
                );
            }
            return str;
        },
        // 编辑规格重新渲染
        renderByIndex: function (data, index) {
            // console.log(data)
            var subRenderArea = $("#sub-sku-" + index);
            subRenderArea.empty();
            // 第一行
            subRenderArea.append(
                this.buildFirstLine(data, index)
            );
            var length = data["values"].length;
            var d_length = length - 5;
            // 其他行
            if (d_length > 0) {
                var lineCount = Math.ceil(d_length / 5);
                for (var i = 0; i < lineCount; i++) {
                    subRenderArea.append(
                        this.buildOtherLine(data, index, i * 5 + 5)
                    );
                }
            }
            // 最后填充一条分割线
            subRenderArea.append(
                $("<div class='col-sm-12' style='margin-top: 10px; border-bottom: 1px solid rgba(204, 204, 204, 1);'></div>")
            )
        },
        generateSkuGroup: function () {
            // 获取已有规格组 不依赖于任何容器只需要渲染号规格区就行
            // 构造数据data格式[{}] {}->sku1name:sku1value1,sku2name:sku2value1,sku3name:sku3value1
            var sku1Arr = $("input[id^='radio-0']:checked");
            var sku1Name = $("#input-sku-name-0").val();

            var sku2Arr = $("input[id^='radio-1']:checked");
            var sku2Name = $("#input-sku-name-1").val();

            var sku3Arr = $("input[id^='radio-2']:checked");
            var sku3Name = $("#input-sku-name-2").val();
            var checkedLength = 0;
            var check1 = false;
            var check2 = false;
            var check3 = false;
            if (sku1Arr.length > 0) {
                check1 = true;
                checkedLength += 1;
            }
            if (sku2Arr.length > 0) {
                check2 = true;
                checkedLength += 1;
            }
            if (sku3Arr.length > 0) {
                check3 = true;
                checkedLength += 1;
            }
            // 小于两组则不渲染
            checkedSkuGroupCount = checkedLength;
            if (checkedLength < 1) {
                return;
            }
            // 如果有两组及以上的sku被勾选,则开始排列组合
            // 第一组
            var firstSkuName;
            var firstSkuArray = new Array();
            // data格式[{}] {}->sku1name:sku1value1,sku2name:sku2value1,sku3name:sku3value1
            var dataObj = {};
            // 勾选组数
            dataObj["skuLength"] = checkedLength;
            // 清空组合里第一规格值容器
            firstSkuValueArr = [];
            var data = new Array();
            // 如果第一组被勾选
            if (check1) {
                dataObj["sku1Name"] = sku1Name;
            } else {
                dataObj["sku1Name"] = undefined;
            }

            if (check2) {
                dataObj["sku2Name"] = sku2Name;
            } else {
                dataObj["sku2Name"] = undefined;
            }

            if (check3) {
                dataObj["sku3Name"] = sku3Name;
            } else {
                dataObj["sku3Name"] = undefined;
            }

            if (check1) {
                firstSkuName = sku1Name;

                // dataObj["sku1Name"] = sku1Name;
                sku1Arr.each(function (index1, ele1) {
                    var sku1Value = $(this).val();
                    firstSkuValueArr.push(sku1Value);
                    firstSkuArray.push(sku1Value);
                    // 如果第二组也被勾选
                    if (check2) {
                        // dataObj["sku2Name"] = sku2Name;
                        sku2Arr.each(function (index2, ele2) {
                            var sku2Value = $(this).val();
                            // 如果第三组也被勾选 -> 1,2,3
                            if (check3) {
                                // dataObj["sku3Name"] = sku3Name;
                                sku3Arr.each(function (index3, ele3) {
                                    var sku3Value = $(this).val();
                                    var skuObj = {};
                                    skuObj[sku1Name] = sku1Value;
                                    skuObj[sku2Name] = sku2Value;
                                    skuObj[sku3Name] = sku3Value;
                                    data.push(skuObj);
                                });
                            }
                            // 第三组没勾选 -> 1,2
                            else {
                                // dataObj["sku3Name"] = undefined;
                                var skuObj = {};
                                skuObj[sku1Name] = sku1Value;
                                skuObj[sku2Name] = sku2Value;
                                data.push(skuObj);
                            }
                        });
                    }
                    // 第二组没勾选但是第三组勾选了 -> 1,3
                    else if (check3) {
                        // dataObj["sku2Name"] = undefined;
                        // dataObj["sku3Name"] = sku3Name;
                        sku3Arr.each(function (index3, ele3) {
                            var sku3Value = $(this).val();
                            var skuObj = {};
                            skuObj[sku1Name] = sku1Value;
                            skuObj[sku3Name] = sku3Value;
                            data.push(skuObj);
                        });
                    }
                    // 第二第三组都没勾选
                    else {
                        // dataObj["sku2Name"] = undefined;
                        // dataObj["sku3Name"] = undefined;
                        var skuObj = {};
                        skuObj[sku1Name] = sku1Value;
                        data.push(skuObj);
                    }
                });
            }
            // 第一组没勾选 但是勾选了2
            else if (check2) {
                firstSkuName = sku2Name;

                // dataObj["sku1Name"] = undefined;
                // dataObj["sku2Name"] = sku2Name;

                if (check3) {
                    // dataObj["sku3Name"] = sku3Name;
                    sku2Arr.each(function (index2, ele2) {
                        var sku2Value = $(this).val();
                        firstSkuArray.push(sku2Value);
                        firstSkuValueArr.push(sku2Value);
                        sku3Arr.each(function (index3, ele3) {
                            var sku3Value = $(this).val();
                            var skuObj = {};
                            skuObj[sku2Name] = sku2Value;
                            skuObj[sku3Name] = sku3Value;
                            data.push(skuObj);
                        });
                    });
                } else {
                    // dataObj["sku3Name"] = undefined;
                    sku2Arr.each(function (index2, ele2) {
                        var sku2Value = $(this).val();
                        firstSkuArray.push(sku2Value);
                        var skuObj = {};
                        skuObj[sku2Name] = sku2Value;
                        data.push(skuObj);
                    });
                }
            }
            // 只勾选了3
            else if (check3) {
                firstSkuName = sku3Name;
                sku3Arr.each(function (index3, ele3) {
                    var sku3Value = $(this).val();
                    var skuObj = {};
                    skuObj[sku3Name] = sku3Value;
                    data.push(skuObj);
                });
            }
            dataObj["data"] = data;
            // 组合完之后渲染到组合区
            renderSkuGroup(data);
            // 为第一个sku渲染图片上传
            renderUploaders(firstSkuName, firstSkuArray);
        }
    }

    // 属性值数据容器 {nameArr:存储属性名称的数组,name1:[]}
    var propertyContainer;
    var propertyManager = {
        // 初始化容器
        init: function () {
            propertyContainer = {
                "nameArr": []
            };
        },
        // 清空容器
        clean: function () {
            propertyContainer = {};
        },
        // 增加一种规格
        // data = {name:string, values:[string]}
        add: function (data) {
            if (this.containName(data["name"])) {
                alert("规格已存在");
                return false;
            }
            propertyContainer["nameArr"].push(data["name"]);
            propertyContainer[data["name"]] = [];
            propertyContainer[data["name"]] = propertyContainer[data["name"]].concat(data["values"]);
            return true;
        },
        // 更新一种规格
        // property页面更新
        updateFromEditor: function (data, oldIndex) {
            if (propertyContainer["nameArr"][oldIndex] != data["name"]) {
                if (this.containName(data["name"])) {
                    alert("规格已存在");
                    return false;
                }
            }
            this.deleteValueArr(propertyContainer["nameArr"][oldIndex]);
            propertyContainer["nameArr"][oldIndex] = data["name"];
            propertyContainer[data["name"]] = [];
            propertyContainer[data["name"]] = propertyContainer[data["name"]].concat(data["values"]);
            return true;
        },
        // 修改规格值
        // input框修改property值
        updateValue: function (name, oldValue, newValue) {
            if (this.containValue(name, newValue)) {
                alert("规格值已存在");
                return;
            }
            var index = propertyContainer[name].indexOf(oldValue);
            propertyContainer[name][index] = newValue;
        },
        get: function () {

        },
        // 删除一种规格
        // 只删除容器里的某个属性的属性值数组，而不删除属性名称
        deleteValueArr: function (name) {
            delete propertyContainer[name];
        },
        // 是否包含规格名
        containName: function (name) {
            if (propertyContainer["nameArr"].indexOf(name) > -1) {
                return true;
            }
            return false;
        },
        // 某种规格名的规格是否包含某个规格值
        containValue: function (name, value) {
            if (propertyContainer[name].indexOf(value) > -1) {
                return true;
            }
            return false;
        }
    }

    function validateForm() {
        $(formId).submit();
    }

    // 关联厂家事件 查询修改物流规则option, 按物流规则类型修改物流参数
    $("#select_shop_id").change(function () {
        var shopId = $(this).val();
        var ruleUrl = "/s/goods/getPostRule";
        // 渲染select-postFeeType-rule
        $.post(ruleUrl, {"shopId": shopId}, function (data, status) {
            if (status == "success") {
                var ruleList = data["data"]["ruleList"];
                if (ruleList == undefined || ruleList == null) {
                    $("#select-postFeeType-rule").empty();
                } else if (ruleList.length < 1) {
                    $("#select-postFeeType-rule").empty();
                } else {
                    $("#select-postFeeType-rule").empty();

                    ruleList.forEach(function (ele, index) {
                        $("#select-postFeeType-rule").append(
                            $("<option value='" + ele["id"] + "' data-fee-type='" + ele["feeType"] + "'>" + ele["name"] + "</option>")
                        );
                    });
                }
                $("#select-postFeeType-rule").trigger("chosen:updated");
                // 更新之后,重新渲染物流参数
                renderPostArgs();

            } else {
                $("#select-postFeeType-rule").empty();
                $("#select-postFeeType-rule").trigger("chosen:updated");
                alert("请求失败");
            }
        });
    });

    // 物流规则select切换事件 - 渲染物流参数
    $("#select-postFeeType-rule").change(function () {
        // 物流参数
        renderPostArgs();
    });

    // 渲染物流参数
    function renderPostArgs() {
        var ruleFeeType = $("#select-postFeeType-rule option:selected").data("fee-type");
        if (ruleFeeType === 1) {
            $("#label_postCapacity").html("件数");
            $("#label_postCapacity_unit").html("件");
        } else if (ruleFeeType === 2) {
            $("#label_postCapacity").html("重量");
            $("#label_postCapacity_unit").html("kg");
        } else if (ruleFeeType == 3) {
            $("#label_postCapacity").html("体积");
            $("#label_postCapacity_unit").html("m³");
        }
    }

    // 物流信息 radio点击事件
    $("input[name='postFeeType']").change(function () {
        var feeType = $(this).val();
        if (feeType === "1") {
            $("#input-postFeeType-fixed").removeAttr("disabled");
            $("#select-postFeeType-rule").attr("disabled", "disabled");
            $("#select-postFeeType-rule").trigger("chosen:updated");
        } else if (feeType === "2") {
            $("#input-postFeeType-fixed").attr("disabled", "disabled");
            $("#select-postFeeType-rule").removeAttr("disabled");
            $("#select-postFeeType-rule").trigger("chosen:updated");
            $("#hide_input_postFeeType").val("2");
            renderPostArgs();
        }
    });

    /* 选择事件 暂时没用*/
    function selectEvent(element) {
        var propertyId = element.value;
        if (propertyId == null || propertyId == '') {
            return;
        }
        $.ajax({
            type: "POST",
            data: {id: propertyId},
            url: getPropertyUrl,
            success: function (result) {
                if (result.code == 200) {
                    var option = "";
                    $.each(result.data, function (key, val) {
                        // option += '<option value="' + val.id + '">' + val.title + '</option>';
                    });
                    // $("#twoType").html('<option></option>' + option);
                }
            }
        });
    }

    $("#addSku").click(function () {
        skuManager.addGroupAndRender();
    });

    /**
     * 规格勾选，变为可编辑装填，并且根据数量渲染jqgrid和图片上传区
     * @param index 对应的sku index 表示第几组
     * @param id 对应的规格值id 表示第几个规格值
     */
    function radioOnchange(index, id) {
        // 对于data-is-checked=true则置为非选择
        // 获取所有该name的input,对于不是指定id的统一消失,是指定id的则显示
        var radioArray = $("input[name='sku-" + index + "']");
        radioArray.each(function (sub_index, ele) {
            var id_index = $(this).data("id-index");
            if ($(this).is(":checked")) {
                $("#label-" + index + "-" + id_index).hide();
                $("#input-" + index + "-" + id_index).show();
                // 执行一次渲染逻辑
                skuManager.generateSkuGroup();
            } else {
                // 对于所有非选中
                $("#label-" + index + "-" + id_index).show();
                $("#input-" + index + "-" + id_index).hide();
            }
        });

    }

    /**
     * input框修改事件,要修改对应id的radio和label值
     * @param index 规格的 index 1,2,3
     * @param id    规格值的index 1-10
     */
    function inputChange(index, id) {
        // 修改对应的radio-index-id 和label-index-id的值
        var val = $("#input-" + index + "-" + id).val();
        $("#label-" + index + "-" + id).html(val);
        $("#radio-" + index + "-" + id).val(val);
        // 重新渲染数据
        renderSkuInJqGrid();
    }

    function groupLengthCheck() {
        // 获取已有规格组
        var sku1Arr = $("input[id^='radio-1']:checked");
        var sku1Name = $("#input-sku-name-1").val();

        var sku2Arr = $("input[id^='radio-2']:checked");
        var sku2Name = $("#input-sku-name-2").val();

        var sku3Arr = $("input[id^='radio-3']:checked");
        var sku3Name = $("#input-sku-name-3").val();
        var checkedLength = 0;
        var check1 = false;
        var check2 = false;
        var check3 = false;
        if (sku1Arr.length > 0) {
            check1 = true;
            checkedLength += 1;
        }
        if (sku2Arr.length > 0) {
            check2 = true;
            checkedLength += 1;
        }
        if (sku3Arr.length > 0) {
            check3 = true;
            checkedLength += 1;
        }
        // 小于两组则不渲染
        checkedSkuGroupCount = checkedLength;
        if (checkedLength < 1) {
            return false;
        }
        return true;
    }

    /**
     * 已勾选规格值修改时,汇总当前sku,重新渲染对应的格子
     * @param index
     * @param id
     */
    function renderSkuInJqGrid() {
        if (!groupLengthCheck()) {
            return;
        }
        skuManager.generateSkuGroup();
    }

    // 编辑sku
    function editSku(data, index) {
        skuManager.updateGroupAndRender(data, index);
    }

    // // sku勾选触发组合 构造sku数据，然后渲染jqgrid和图片上传
    // function generateSkuGroup() {
    //     // 获取已有规格组
    //     var sku1Arr = $("input[id^='radio-1']:checked");
    //     var sku1Name = $("#input-sku-name-1").val();
    //
    //     var sku2Arr = $("input[id^='radio-2']:checked");
    //     var sku2Name = $("#input-sku-name-2").val();
    //
    //     var sku3Arr = $("input[id^='radio-3']:checked");
    //     var sku3Name = $("#input-sku-name-3").val();
    //     var checkedLength = 0;
    //     var check1 = false;
    //     var check2 = false;
    //     var check3 = false;
    //     if (sku1Arr.length > 0) {
    //         check1 = true;
    //         checkedLength += 1;
    //     }
    //     if (sku2Arr.length > 0) {
    //         check2 = true;
    //         checkedLength += 1;
    //     }
    //     if (sku3Arr.length > 0) {
    //         check3 = true;
    //         checkedLength += 1;
    //     }
    //     // 小于两组则不渲染
    //     checkedSkuGroupCount = checkedLength;
    //     if (checkedLength < 1) {
    //         return;
    //     }
    //     // 如果有两组及以上的sku被勾选,则开始排列组合
    //     // 第一组
    //     var firstSkuName;
    //     var firstSkuArray = new Array();
    //     // data格式[{}] {}->sku1name:sku1value1,sku2name:sku2value1,sku3name:sku3value1
    //     var dataObj = {};
    //     // 勾选组数
    //     dataObj["skuLength"] = checkedLength;
    //     // 清空组合里第一规格值容器
    //     firstSkuValueArr = [];
    //     var data = new Array();
    //     // 如果第一组被勾选
    //     if (check1) {
    //         dataObj["sku1Name"] = sku1Name;
    //     } else {
    //         dataObj["sku1Name"] = undefined;
    //     }
    //
    //     if (check2) {
    //         dataObj["sku2Name"] = sku2Name;
    //     } else {
    //         dataObj["sku2Name"] = undefined;
    //     }
    //
    //     if (check3) {
    //         dataObj["sku3Name"] = sku3Name;
    //     } else {
    //         dataObj["sku3Name"] = undefined;
    //     }
    //
    //     if (check1) {
    //         firstSkuName = sku1Name;
    //
    //         // dataObj["sku1Name"] = sku1Name;
    //         sku1Arr.each(function (index1, ele1) {
    //             var sku1Value = $(this).val();
    //             firstSkuValueArr.push(sku1Value);
    //             firstSkuArray.push(sku1Value);
    //             // 如果第二组也被勾选
    //             if (check2) {
    //                 // dataObj["sku2Name"] = sku2Name;
    //                 sku2Arr.each(function (index2, ele2) {
    //                     var sku2Value = $(this).val();
    //                     // 如果第三组也被勾选 -> 1,2,3
    //                     if (check3) {
    //                         // dataObj["sku3Name"] = sku3Name;
    //                         sku3Arr.each(function (index3, ele3) {
    //                             var sku3Value = $(this).val();
    //                             var skuObj = {};
    //                             skuObj[sku1Name] = sku1Value;
    //                             skuObj[sku2Name] = sku2Value;
    //                             skuObj[sku3Name] = sku3Value;
    //                             data.push(skuObj);
    //                         });
    //                     }
    //                     // 第三组没勾选 -> 1,2
    //                     else {
    //                         // dataObj["sku3Name"] = undefined;
    //                         var skuObj = {};
    //                         skuObj[sku1Name] = sku1Value;
    //                         skuObj[sku2Name] = sku2Value;
    //                         data.push(skuObj);
    //                     }
    //                 });
    //             }
    //             // 第二组没勾选但是第三组勾选了 -> 1,3
    //             else if (check3) {
    //                 // dataObj["sku2Name"] = undefined;
    //                 // dataObj["sku3Name"] = sku3Name;
    //                 sku3Arr.each(function (index3, ele3) {
    //                     var sku3Value = $(this).val();
    //                     var skuObj = {};
    //                     skuObj[sku1Name] = sku1Value;
    //                     skuObj[sku3Name] = sku3Value;
    //                     data.push(skuObj);
    //                 });
    //             }
    //             // 第二第三组都没勾选
    //             else {
    //                 // dataObj["sku2Name"] = undefined;
    //                 // dataObj["sku3Name"] = undefined;
    //                 var skuObj = {};
    //                 skuObj[sku1Name] = sku1Value;
    //                 data.push(skuObj);
    //             }
    //         });
    //     }
    //     // 第一组没勾选 但是勾选了2
    //     else if (check2) {
    //         firstSkuName = sku2Name;
    //
    //         // dataObj["sku1Name"] = undefined;
    //         // dataObj["sku2Name"] = sku2Name;
    //
    //         if (check3) {
    //             // dataObj["sku3Name"] = sku3Name;
    //             sku2Arr.each(function (index2, ele2) {
    //                 var sku2Value = $(this).val();
    //                 firstSkuArray.push(sku2Value);
    //                 firstSkuValueArr.push(sku2Value);
    //                 sku3Arr.each(function (index3, ele3) {
    //                     var sku3Value = $(this).val();
    //                     var skuObj = {};
    //                     skuObj[sku2Name] = sku2Value;
    //                     skuObj[sku3Name] = sku3Value;
    //                     data.push(skuObj);
    //                 });
    //             });
    //         } else {
    //             // dataObj["sku3Name"] = undefined;
    //             sku2Arr.each(function (index2, ele2) {
    //                 var sku2Value = $(this).val();
    //                 firstSkuArray.push(sku2Value);
    //                 var skuObj = {};
    //                 skuObj[sku2Name] = sku2Value;
    //                 data.push(skuObj);
    //             });
    //         }
    //     }
    //     // 只勾选了3
    //     else if (check3) {
    //         firstSkuName = sku3Name;
    //         sku3Arr.each(function (index3, ele3) {
    //             var sku3Value = $(this).val();
    //             var skuObj = {};
    //             skuObj[sku3Name] = sku3Value;
    //             data.push(skuObj);
    //         });
    //     }
    //     dataObj["data"] = data;
    //
    //     // 组合完之后渲染到组合区
    //     renderSkuGroup(data);
    //     // 为第一个sku渲染图片上传
    //     renderUploaders(firstSkuName, firstSkuArray);
    // }

    var totalRow = 0;

    // 渲染sku组合 data -> {skulength:, sku1Name, sku2Name,sku3Name, data:[{},{}]}, [{}]->{sku1name:sku1value1,sku2name:sku2value1,sku3name:sku3value1}
    function renderSkuGroup(groupArr) {
        // console.log(groupArr)
        // console.log(groupArr[0]);
        // 渲染之前先清除旧的
        $(jqGridId).jqGrid("clearGridData");
        // 使用jqgrid local渲染
        // 修改表头
        // var groupArr = data["data"];
        if (groupArr.length < 1) {
            return;
        }
        var obj = groupArr[0];
        var skuNames = Object.keys(obj);
        if (skuNames.length > 2) {
            // console.log("3 groups")

            var sku1Arr = groupArr.map(function (ele, index) {
                return ele[skuNames[0]];
            });
            $(jqGridId).jqGrid("setLabel", "sku1", skuNames[0]);

            var sku2Arr = groupArr.map(function (ele, index) {
                return ele[skuNames[1]];
            });
            $(jqGridId).setGridParam().showCol("sku2");
            $(jqGridId).jqGrid("setLabel", "sku2", skuNames[1]);

            var sku3Arr = groupArr.map(function (ele, index) {
                return ele[skuNames[2]];
            });
            $(jqGridId).setGridParam().showCol("sku3");
            $(jqGridId).jqGrid("setLabel", "sku3", skuNames[2]);

            while (groupArr.length > 0) {
                obj = groupArr.shift();
                var rowid = totalRow;
                var dataGrid = {
                    "sku1": obj[skuNames[0]],
                    "sku2": obj[skuNames[1]],
                    "sku3": obj[skuNames[2]],
                    "sku1Name": skuNames[0],
                    "sku2Name": skuNames[1],
                    "sku3Name": skuNames[2],
                    "costAmount": "0.00",
                    "sellAmount": "0.00",
                    "discountAmount": "",
                    "storage": "",
                    "postCount": "1",
                };
                $(jqGridId).jqGrid("addRowData", rowid, dataGrid);
                totalRow += 1;
            }
        } else if (skuNames.length > 1) {
            // console.log("2 groups",skuNames[0],skuNames[1]);

            var sku1Arr = groupArr.map(function (ele, index) {
                return ele[skuNames[0]];
            });
            $(jqGridId).jqGrid("setLabel", "sku1", skuNames[0]);

            var sku2Arr = groupArr.map(function (ele, index) {
                return ele[skuNames[1]];
            });
            $(jqGridId).setGridParam().showCol("sku2");
            $(jqGridId).jqGrid("setLabel", "sku2", skuNames[1]);

            $(jqGridId).setGridParam().hideCol("sku3");

            while (groupArr.length > 0) {
                obj = groupArr.shift();
                var rowid = totalRow;
                var dataGrid = {
                    "sku1": obj[skuNames[0]],
                    "sku2": obj[skuNames[1]],
                    "sku1Name": skuNames[0],
                    "sku2Name": skuNames[1],
                    "costAmount": "0.00",
                    "sellAmount": "0.00",
                    "discountAmount": "",
                    "storage": "",
                    "postCount": "1"
                }
                $(jqGridId).jqGrid("addRowData", rowid, dataGrid);
                totalRow += 1;
            }
        } else {
            // console.log("1 group")

            var sku1Arr = groupArr.map(function (ele, index) {
                return ele[skuNames[0]];
            });
            $(jqGridId).jqGrid("setLabel", "sku1", skuNames[0]);

            $(jqGridId).setGridParam().hideCol("sku2");
            $(jqGridId).setGridParam().hideCol("sku3");

            while (groupArr.length > 0) {
                obj = groupArr.shift();
                var rowid = totalRow;
                var dataGrid = {
                    "sku1": obj[skuNames[0]],
                    "sku1Name": skuNames[0],
                    "costAmount": "0.00",
                    "sellAmount": "0.00",
                    "discountAmount": "",
                    "storage": "",
                    "postCount": "1"
                }
                $(jqGridId).jqGrid("addRowData", rowid, dataGrid);
                totalRow += 1;
            }
        }
    }

    // jqgrid local渲染,用于展示sku组合
    // { label: '<a href="HtmlPage1.html" title="测试标题">OrderID</a>', name: 'OrderID', key: true, width: 75 }
    $(function () {
        $.jgrid.defaults.styleUI = "Bootstrap";
        $(jqGridId).jqGrid({
            datatype: "local",
            colModel: [
                {
                    label: 'ID',
                    name: 'ids',
                    index: 'ids',
                    width: 1,
                    hidden: true,
                    key: true
                },
                {
                    label: '规格1',
                    name: 'sku1',
                    index: 'sku1',
                    width: '75',
                    formatter: function (cellvalue, options, rowValue) {
                        var str = "<div>" + cellvalue + "<input type='hidden' data-sku1name='" + rowValue.sku1Name + "' value='" + cellvalue + "'></div>";
                        return str;
                    }
                },
                {
                    label: '规格2',
                    name: 'sku2',
                    index: 'sku2',
                    width: '75',
                    formatter: function (cellvalue, options, rowValue) {
                        var str = "<div>" + cellvalue + "<input type='hidden' data-sku2name='" + rowValue.sku2Name + "' value='" + cellvalue + "'></div>";
                        return str;
                    }
                },
                {
                    label: '规格3',
                    name: 'sku3',
                    index: 'sku3',
                    width: '75',
                    formatter: function (cellvalue, options, rowValue) {
                        var str = "<div>" + cellvalue + "<input type='hidden' data-sku3name='" + rowValue.sku3Name + "' value='" + cellvalue + "'></div>";
                        return str;
                    }
                },
                {
                    label: '<div><label>成本价</label><button type="button" style="background:transparent; border:none;vertical-align: middle;" onclick="setAllCost()"><i class="fa fa-edit fa-2x" style="color:#acacac;"></i></button></div>',
                    name: 'costAmount',
                    index: 'costAmount',
                    width: '100',
                    formatter: function (cellvalue, options, rowValue) {
                        var rowId = options.rowId;
                        var str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='costAmount-" + options.rowId + "' value='" + cellvalue + "' onchange='cellInputChange(" + rowId + ",\"costAmount\")'>";
                        return str;
                    },
                    sortable: false
                },
                {
                    label: '<div><label>销售价格</label><button type="button" style="background:transparent; border:none;vertical-align: middle;" onclick="setAllSell()"><i class="fa fa-edit fa-2x" style="color:#acacac;"></i></button></div>',
                    name: 'sellAmount',
                    index: 'sellAmount',
                    width: '100',
                    formatter: function (cellvalue, options, rowValue) {
                        var rowId = options.rowId;
                        var str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='sellAmount-" + rowId + "' value='" + cellvalue + "' onchange='cellInputChange(" + rowId + ",\"sellAmount\")'>";
                        return str;
                    },
                    sortable: false
                },
                {
                    label: '<div><label>折扣价格</label><button type="button" style="background:transparent; border:none;vertical-align: middle;" onclick="setAllDiscount()"><i class="fa fa-edit fa-2x" style="color:#acacac;"></i></button></div>',
                    name: 'discountAmount',
                    index: 'discountAmount',
                    width: '100',
                    formatter: function (cellvalue, options, rowValue) {
                        var rowId = options.rowId;
                        var str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='discountAmount-" + rowId + "' value='" + cellvalue + "' onchange='cellInputChange(" + rowId + ",\"discountAmount\")'>";
                        return str;
                    },
                    sortable: false
                },
                {
                    label: '<div><label>库存</label><button type="button" style="background:transparent; border:none;vertical-align: middle;" onclick="setAllStorage()"><i class="fa fa-edit fa-2x" style="color:#acacac;"></i></button></div>',
                    name: 'storage',
                    index: 'storage',
                    width: '100',
                    formatter: function (cellvalue, options, rowValue) {
                        var rowId = options.rowId;
                        var str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='storage-" + rowId + "' value='" + cellvalue + "' onchange='cellInputChange(" + rowId + ",\"storage\")'>";
                        return str;
                    },
                    sortable: false
                },
                {
                    label: '<div><label title="商品物流单位的整倍数,用于运费模板">物流件数</label><button type="button" style="background:transparent; border:none;vertical-align: middle;" onclick="setAllPostCount()"><i class="fa fa-edit fa-2x" style="color:#acacac;"></i></button></div>',
                    name: 'postCount',
                    index: 'postCount',
                    width: '100',
                    formatter: function (cellvalue, options, rowValue) {
                        var rowId = options.rowId;
                        var str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='postCount-" + rowId + "' value='" + cellvalue + "' onchange='cellInputChange(" + rowId + ",\"postCount\")'>";
                        return str;
                    },
                    sortable: false
                },
                {
                    label: '<div><label>抵扣小红花</label><button type="button" style="background:transparent; border:none;vertical-align: middle;" onclick="setAllRedFlower()"><i class="fa fa-edit fa-2x" style="color:#acacac;"></i></button></div>',
                    name: 'redFlowerNumber',
                    index: 'redFlowerNumber',
                    width: '110',
                    formatter: function (cellvalue, options, rowValue) {
                        var rowId = options.rowId;
                        var str="";
                        if (cellvalue == null){
                            str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='redFlowerNumber-" + rowId + "' value='' onchange='cellInputChange(" + rowId + ",\"redFlowerNumber\")' required>";
                        } else {
                            str = "<input style='width: 100%;' type='text' name='sku" + options.rowId + "' id='redFlowerNumber-" + rowId + "' value='" + cellvalue + "' onchange='cellInputChange(" + rowId + ",\"redFlowerNumber\")' required>";
                        }

                        return str;
                    },
                    sortable: false
                }
            ],
            autowidth: true,
            height: "100%",    // 设为具体数值则会根据实际记录数出现垂直滚动条
            width: "100%",
            rowNum: 20,
            rowList: [20, 30, 50],
            mtype: "post",
            viewrecords: true,
            rownumbers: true,
            rownumWidth: 75,
            multiselect: false,
            hoverrows: false,
            cellsubmit: "clientArray",

        });

        jQuery(jqGridId).jqGrid('setLabel', 'rn', '序号', {
            'text-align': 'center',
            'vertical-align': 'middle',
            'width': '50'
        }, '');
        jQuery(jqGridId).jqGrid('navGrid', "", {
                add: false,
                del: false,
                edit: false,
                search: false,
                position: 'right'
            }
        );

    });

    // 成本价单元格编辑
    function cellInputChange(rowId, type) {
        var amount = $("#" + type + "-" + rowId).val();
        $(jqGridId).jqGrid("setCell", rowId, type, amount);
    }

    // 批量设置成本价
    function setAllCost() {
        // 获取所有行, 对每一行的某个列执行修改
        layer.open({
            title: "批量设置成本价",
            content: "批量设置成本价:<input id='editCost'>",
            yes: function (index, layero) {
                var costAmount = $("#editCost").val();
                var rowIds = $(jqGridId).getDataIDs();
                rowIds.forEach(function (ele, index) {
                    $(jqGridId).jqGrid("setCell", ele, "costAmount", costAmount);
                });
                layer.close(index);
            }
        });

    }

    // 批量设置折扣价
    function setAllDiscount() {
        // 获取所有行, 对每一行的某个列执行修改
        layer.open({
            title: "批量设置折扣价格",
            content: "批量设置折扣价格:<input id='editDiscount'>",
            yes: function (index, layero) {
                var costAmount = $("#editDiscount").val();
                var rowIds = $(jqGridId).getDataIDs();
                rowIds.forEach(function (ele, index) {
                    $(jqGridId).jqGrid("setCell", ele, "discountAmount", costAmount);
                });
                layer.close(index);
            }
        });
    }

    // 批量设置销售价格
    function setAllSell() {
        // 获取所有行, 对每一行的某个列执行修改
        layer.open({
            title: "批量设置销售价格",
            content: "批量设置销售价格:<input id='editSell'>",
            yes: function (index, layero) {
                var costAmount = $("#editSell").val();
                var rowIds = $(jqGridId).getDataIDs();
                rowIds.forEach(function (ele, index) {
                    $(jqGridId).jqGrid("setCell", ele, "sellAmount", costAmount);
                });
                layer.close(index);
            }
        });
    }

    // 批量设置库存
    function setAllStorage() {
        // 获取所有行, 对每一行的某个列执行修改
        layer.open({
            title: "批量设置库存",
            content: "批量设置库存:<input id='editStorage'>",
            yes: function (index, layero) {
                var costAmount = $("#editStorage").val();
                var rowIds = $(jqGridId).getDataIDs();
                rowIds.forEach(function (ele, index) {
                    $(jqGridId).jqGrid("setCell", ele, "storage", costAmount);
                });
                layer.close(index);
            }
        });
    }

    // 批量设置物流件数
    function setAllPostCount() {
        // 获取所有行, 对每一行的某个列执行修改
        layer.open({
            title: "批量设置物流件数",
            content: "批量设置物流件数:<input id='editPostCount'>",
            yes: function (index, layero) {
                var costAmount = $("#editPostCount").val();
                var rowIds = $(jqGridId).getDataIDs();
                rowIds.forEach(function (ele, index) {
                    $(jqGridId).jqGrid("setCell", ele, "postCount", costAmount);
                });
                layer.close(index);
            }
        });
    }
    // 批量设置抵扣小红花
    function setAllRedFlower() {
        // 获取所有行, 对每一行的某个列执行修改
        layer.open({
            title: "批量设置抵扣小红花",
            content: "批量设置抵扣小红花:<input id='editRedFlower'>",
            yes: function (index, layero) {
                var costAmount = $("#editRedFlower").val();
                var rowIds = $(jqGridId).getDataIDs();
                rowIds.forEach(function (ele, index) {
                    $(jqGridId).jqGrid("setCell", ele, "redFlowerNumber", costAmount);
                });
                layer.close(index);
            }
        });
    }

    // 渲染图片上传区
    function renderUploaders(name, valueArray) {
        // 渲染最外层
        var $uploaderDiv = $("#uploader-div");

        // 去掉已经存在的
        var contentArr = $uploaderDiv.find(".ibox-content");
        contentArr.each(function (index, ele) {
            $(this).remove();
        });

        // 初始化容器
        initContainer(name, valueArray);

        // 为每个规格值追加一个uploader
        valueArray.forEach(function (ele, index) {
            $uploaderDiv.append($(renderOneUploader(name, ele, index)));
            uploaderManager.buildBigUploader(ele, index, 1);
        });

    }

    // 构造一个上传区
    function renderOneUploader(name, value, index) {
        var html = '<div class="ibox-content" style="border: 1px solid #e7eaec; margin-top: 10px;">' +
            '<div class="page-container">' +
            '<label>' + name + ':' + value + '</label>' +
            '<div id="uploader-' + index + '" class="wu-example">' +
            '<div class="queueList">' +
            '<div id="dndArea-' + index + '" class="placeholder">' +
            '<div id="filePicker-' + index + '"></div>' +
            '<p>或将照片拖到这里，单次最多可选1张</p>' +
            '</div>' +
            '</div>' +
            '<div class="statusBar" style="display:none;">' +
            '<div class="progress">' +
            '<span class="text">0%</span>' +
            '<span class="percentage"></span>' +
            '</div>' +
            '<div class="info"></div>' +
            '<div class="btns">' +
            '<div id="filePicker2-' + index + '"></div>' +
            '<div class="uploadBtn" id="uploadBtn-' + index + '">开始上传</div>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>';
        return html;
    }

    if (!WebUploader.Uploader.support()) {
        alert('Web Uploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器');
        throw new Error('WebUploader does not support the browser you are using.');
    }

    // 清空并初始化容器
    function initContainer(name, valueArr) {
        urlContainer = {
            "name": name
        };
        valueArr.forEach(function (ele, index) {
            urlContainer[ele] = [];
        });
    }

    // 提交数据
    function buildSubmitData() {
        // if (checkedSkuGroupCount < 1) {
        //     return;
        // }
        // 商品分类
        var goodsDic = $("#select_types_type").val();
        var goodsType = $("#select_goods_type").val();
        var storage = $("#input_goods_storage").val();
        var flower = $("#input_goods_flower").val();
        var totalPrice = $("#input_goods_price").val();
        // 商品名称
        var goodsName = $("#input_product_name").val();
        // 商品描述
        var goodsDescribe = $("#input_goods_describe").val();
        // 关联厂家 id
        var shopId = $("#select_shop_id").val();
        // 商品sku, 成本价, 销售价,折扣价, 库存 从jqgrid里获取
        //[{}]->{name1,value1,[name2,value2,name3,value3],costamount, sellamount, discountamount, storage}
        var rowData = getJqgridData();
        var properties = getProperties();
        // 商品sku图片 从容器里获取 urlContainer {sku1value1:[str1,str2],sku1value2:[str1,str2]...}
        if (urlContainer) urlContainer["valueArr"] = firstSkuValueArr;
        // 运费类型 1固定, 2模板
        var postFeeType = $("input[name='postFeeType']:checked").val();
        var postFeeValue = "";
        // 运费值或运费id
        if (postFeeType == "1") {
            // 固定运费值
            postFeeValue = $("#input-postFeeType-fixed").val();
        } else if (postFeeType == "2") {
            // 物流模板id
            postFeeValue = $("#select-postFeeType-rule").val();
        }

        // 是否开发票 1开,0不开
        var invoice = $("input[name='invoice']").val();

        // rowdata的 name改为sku, 而value值改为1,2,3,4
        // 构造json
        if (urlContainer) {
            var urlContainerValueArr = urlContainer["valueArr"];
            var newUrlContainer = {
                "name": urlContainer["name"],
                "valueArr": urlContainer["valueArr"],
            };
            for (var i = 0; i < urlContainerValueArr.length; i++) {
                newUrlContainer[urlContainerValueArr[i]] = [];
                var tempUrlArr = urlContainer[urlContainerValueArr[i]].map(function (ele, index) {
                    return ele["url"];
                });
                newUrlContainer[urlContainerValueArr[i]] = newUrlContainer[urlContainerValueArr[i]].concat(tempUrlArr);
            }
        }


        var data = {
            "goodsDic": goodsDic,
            // 商品种类 int
            "goodsType": goodsType,
            "totalPrice": totalPrice,
            "storage":storage,
            "flower":flower,
            // 商品名称 string
            "goodsName": goodsName,
            // 商品描述 string
            "goodsDescribe": goodsDescribe,
            // 商店id int
            "shopId": shopId,
            // 有勾选的规格的组数 int
            "checkedSkuGroupLength": checkedSkuGroupCount,
            // 规格具体数据 [{"name1": "重量","value1": "1kg","name2": "品种","value2": "脐橙","costAmount": "0.00","sellAmount": "0.00","discountAmount": "0.00","storage": ""}...]
            "skuData": rowData,
            // 图片数组 {"name":主属性名称,"valueArr":[string数组,表示属性值],"属性值1":[string数组,表示图片url],"属性值2":[url数组]...}
            "picUrl": newUrlContainer,
            // app图片 {"pic_arr":[url]} 数组里只有一张图片
            "appPicUrl": arr,
            // 商品缩略图
            "iconPicUrl": iconPicContainer,
            // 运费计算类型 int 1固定,2模板
            "postFeeType": postFeeType,
            // 运费值 运费类型为1则直接区bigdecimal运费值, 运费类型为2,则取int表示运费模板id
            "postFeeValue": postFeeValue,
            // 是否支持发票 int 1支持,2不支持
            "invoice": invoice,
            // 规格数组 {"sku1Name":sku1名称,"sku1Props":[string数组,sku1的属性值]}
            "properties": properties
        };
        // 物流参数 - 使用运费模板时有效
        if (postFeeType == "2") {
            data["goodsPostCount"] = $("#input_postCapacity").val();
        }
        return data;
    }

    // 获取jqgrid表格数据 [{}]->{name1,value1,[name2,value2,name3,value3],costamount, sellamount, discountamount, storage}
    function getJqgridData() {
        var rows = $(jqGridId).jqGrid("getRowData");
        var skuObjArr = new Array();
        // 运费计价方式
        var postFeeType = $("input[name='postFeeType']:checked").val();

        // 容器长度
        rows.forEach(function (ele, index) {
            var counter = 0;
            // 记录一行的sku名和对应的sku值
            var skuObj = {};
            while (counter < checkedSkuGroupCount) {
                // 获取sku的名字和值
                var index = counter + 1;
                var onlyInput = $(ele["sku" + index]).find("input");
                var sku1Name = $(onlyInput).data("sku" + index + "name");
                skuObj["name" + index] = sku1Name;
                skuObj["value" + index] = $(onlyInput).val();
                counter = index;
            }
            // 该sku的成本,售价,折扣价,库存
            skuObj["costAmount"] = $(ele["costAmount"]).val();
            skuObj["sellAmount"] = $(ele["sellAmount"]).val();
            skuObj["discountAmount"] = $(ele["discountAmount"]).val();
            skuObj["storage"] = $(ele["storage"]).val();
            skuObj["redFlowerNumber"] = $(ele["redFlowerNumber"]).val();
            // 运费模板需要获得规格商品数量
            if (postFeeType == "2") {
                skuObj["postCount"] = $(ele["postCount"]).val();
            }
            skuObjArr.push(skuObj);
        });
        return skuObjArr;
    }

    // 获取规格数组
    function getProperties() {
        var sku1Arr = $("input[id^='radio-0']:checked");
        var sku1Name = $("#input-sku-name-0").val();

        var sku2Arr = $("input[id^='radio-1']:checked");
        var sku2Name = $("#input-sku-name-1").val();

        var sku3Arr = $("input[id^='radio-2']:checked");
        var sku3Name = $("#input-sku-name-2").val();
        var property = {};
        if (sku1Arr.length > 0) {
            property["sku1Name"] = sku1Name;
            var sku1arr = [];
            sku1Arr.each(function (index, ele) {
                sku1arr.push($(this).val());
            });
            property["sku1Props"] = sku1arr;
        }
        if (sku2Arr.length > 0) {
            property["sku2Name"] = sku2Name;
            var sku2arr = [];
            sku2Arr.each(function (index, ele) {
                sku2arr.push($(this).val());
            });
            property["sku2Props"] = sku2arr;
        }
        if (sku3Arr.length > 0) {
            property["sku3Name"] = sku3Name;
            var sku3arr = [];
            sku3Arr.each(function (index, ele) {
                sku3arr.push($(this).val());
            });
            property["sku3Props"] = sku3arr;
        }
        return property;
    }

    function checkSubmitData(data) {
        if (isBlank(data["goodsDic"])) {
            alert("必须选择商品种类")
            return false;
        }
        if(isBlank(data["goodsDic"]) == '大礼包'){
            if (isBlank(data["storage"])) {
                alert("必须填写商品库存")
                return false;
            }
        }
        if (isBlank(data["goodsType"])) {
            alert("必须选择商品分类")
            return false;
        }
        if (isBlank(data["goodsName"])) {
            alert("商品名称不能为空")
            return false;
        }
        if (isBlankArr(data["picUrl"])) {
            alert("必须上传商品图片")
            return false;
        }
        if (isBlankArr2(data["appPicUrl"])) {
            alert("必须上传商品详情描述图片")
            return false;
        }
        if (isBlankArr2(data["iconPicUrl"])) {
            alert("必须上传商品缩略图")
            return false;
        }
        if (isBlank(data["postFeeType"])) {
            alert("必须选择运费类型")
            return false;
        }
        // "postFeeValue": postFeeValue,
        if (data["postFeeType"] == "1") {
            if (isBlank(data["postFeeValue"])) {
                alert("必须填写运费");
                return false;
            }
        } else if (data["postFeeType"] == "2") {
            if (isBlank(data["postFeeValue"])) {
                alert("必须选择运费模板");
                return false;
            }
            if (isBlank(data["goodsPostCount"])) {
                alert("物流参数必须填写");
                return false;
            }
        }
        return true;
    }

    function isBlank(val) {
        if (val == undefined || val == "") {
            return true;
        }
        return false;
    }

    function isBlankArr(arr) {
        // 图片数组 {"name":主属性名称,"valueArr":[string数组,表示属性值],"属性值1":[string数组,表示图片url],"属性值2":[url数组]...}
        if (arr == undefined) {
            return true;
        }
        if (arr["valueArr"] == undefined) {
            return true;
        }
        var length = arr["valueArr"].length;
        for (var i = 0; i < length; i++) {
            var ele = arr["valueArr"][i];
            if (arr[ele] == undefined) {
                continue;
            }
            if (arr[ele].length == undefined) {
                continue;
            }
            if (arr[ele].length > 0) {
                return false;
            }
        }
        return true;
    }

    function isBlankArr2(arr) {
        // app图片 {"pic_arr":[url]} 数组里只有一张图片
        if (arr == undefined) {
            return true;
        }
        // if (arr["pic_arr"] == undefined) {
        //     return true;
        // }
        // if (arr["pic_arr"].length == undefined) {
        //     return true;
        // }
        // if (arr["pic_arr"].length > 0) {
        //     return false;
        // }
        return false
    }

    // 确定按钮 提交数据
    $("#saveBtn").click(function () {
        var data = buildSubmitData();
        if (!checkSubmitData(data)) {
            return;
        }
        dlbGoods = []
        dlbPrice = []
        var arr = $('#dlbtb tbody tr td input')
        for (let i = 0; i < arr.length;i++) {
            if(arr[i].value == '' || !arr[i].value) {
                return alert('请填写成本价')
            } else {
                dlbPrice.push(arr[i].value)
            }
        }
        for (let i = 0; i < dlbPrice.length;i++) {
            let obj = {
                id:dlb[i],
                price:dlbPrice[i]
            }
            dlbGoods.push(obj)
        }
        data.dlbGoods = dlbGoods
        var submitUrl = "/s/goods/deployGoods";
        console.log(JSON.stringify(data))
        $.post(submitUrl, {"jsonDataStr": JSON.stringify(data)}, function (data, status) {
            if (data.code == 400) return alert("发布失败")
            if (status == "success") {
                alert("添加商品成功");
                // 刷新页面
                window.location.reload();
            } else {
                alert("请求错误");
            }
        });
    });
</script>
</body>
</html>